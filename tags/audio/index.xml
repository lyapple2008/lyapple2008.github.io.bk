<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Audio on BeYoung</title>
    <link>https://lyapple2008.github.io/tags/audio/</link>
    <description>Recent content in Audio on BeYoung</description>
    <image>
      <title>BeYoung</title>
      <url>https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.152.2</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 ·</copyright>
    <lastBuildDate>Thu, 03 Feb 2022 11:35:16 +0000</lastBuildDate>
    <atom:link href="https://lyapple2008.github.io/tags/audio/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>QMF分析综合滤波器</title>
      <link>https://lyapple2008.github.io/posts/202202/2022-02-03-qmf%E5%88%86%E6%9E%90%E7%BB%BC%E5%90%88%E6%BB%A4%E6%B3%A2%E5%99%A8/</link>
      <pubDate>Thu, 03 Feb 2022 11:35:16 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/202202/2022-02-03-qmf%E5%88%86%E6%9E%90%E7%BB%BC%E5%90%88%E6%BB%A4%E6%B3%A2%E5%99%A8/</guid>
      <description>&lt;h1 id=&#34;分析综合滤波器组的作用&#34;&gt;分析综合滤波器组的作用&lt;/h1&gt;
&lt;p&gt;由于音频信号在不同的频率范围具有不同的特性，因此在音频处理之前通常都会使用分析综合滤波器组将音频信号分成不同的频率子带，再分别进行处理。比如，音频编码中常用到的子带编码（Subband coding）；webrtc的VAD中，会对不同的频率子带计算特征，再综合这些特征计算语音概率。&lt;/p&gt;
&lt;!-- {% asset_img 001.png %} --&gt;
&lt;img src=&#34;https://lyapple2008.github.io/images/2022-02-03-001.png&#34;/&gt;</description>
      <content:encoded><![CDATA[<h1 id="分析综合滤波器组的作用">分析综合滤波器组的作用</h1>
<p>由于音频信号在不同的频率范围具有不同的特性，因此在音频处理之前通常都会使用分析综合滤波器组将音频信号分成不同的频率子带，再分别进行处理。比如，音频编码中常用到的子带编码（Subband coding）；webrtc的VAD中，会对不同的频率子带计算特征，再综合这些特征计算语音概率。</p>
<!-- {% asset_img 001.png %} -->
<img src="/images/2022-02-03-001.png"/>
<h1 id="分析综合滤波器组是如何实现">分析综合滤波器组是如何实现</h1>
<p>在WebRTC中使用最多的是基于IIR实现的二通道QMF分析综合滤波器组，通过二通道QMF滤波器组，可以很方便实现N等分的子带分解，因此这里只介绍二通道QMF滤波器组。</p>
<!-- {% asset_img 002.png %} -->
<img src="/images/2022-02-03-002.png"/>
<p>从上图可以看出，分析综合滤波器包含分析部分和综合部分，当中间没有任何处理时，整个系统的输入输出关系如下：</p>
<!-- {% asset_img 008.png %} -->
<img src="/images/2022-02-03-008.png"/>
<!-- {% asset_img 003.png %} -->
<img src="/images/2022-02-03-003.png"/>
<p>可以看到分析滤波器部分的高通和低通部分的频率响应网线正好是相对pi/2镜像对称的，QMF叫镜像滤波器的由来。图中Xa0代表的就是输入信号的低频部分，而Xa1代表的就是输入信号的高频部分，这样通过分析滤波器后，就可以对信号的低频部分和高频部分进行分别处理了。</p>
<!-- {% asset_img 004.png %} -->
<img src="/images/2022-02-03-004.png"/>
因此只要按下面的等式进行滤波器设计，就可以让A(z)=0，即消除混叠，实现完善重构。
<!-- {% asset_img 005.png %} -->
<img src="/images/2022-02-03-005.png"/>
<p>为了效率，通常会采用多相形式实现QMF组，如下图所示，信号处理前都会进行抽取操作，这些实际处理的数据量就减少了，从而提升了执行效率</p>
<!-- {% asset_img 006.png %} -->
<img src="/images/2022-02-03-006.png"/>
<p>在QMF组的多相形式中对应的低通滤波器和高通滤波器如上式所示。
WebRTC中的实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">void</span> <span class="n">WebRtcSpl_AnalysisQMF</span><span class="p">(</span><span class="k">const</span> <span class="n">int16_t</span><span class="o">*</span> <span class="n">in_data</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">in_data_length</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">int16_t</span><span class="o">*</span> <span class="n">low_band</span><span class="p">,</span> <span class="n">int16_t</span><span class="o">*</span> <span class="n">high_band</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">int32_t</span><span class="o">*</span> <span class="n">filter_state1</span><span class="p">,</span> <span class="n">int32_t</span><span class="o">*</span> <span class="n">filter_state2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int16_t</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">half_in1</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">half_in2</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">filter1</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">filter2</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">size_t</span> <span class="n">band_length</span> <span class="o">=</span> <span class="n">in_data_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">RTC_DCHECK_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">in_data_length</span> <span class="o">%</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">RTC_DCHECK_LE</span><span class="p">(</span><span class="n">band_length</span><span class="p">,</span> <span class="n">kMaxBandFrameLength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">Split</span> <span class="n">even</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">samples</span><span class="o">.</span> <span class="n">Also</span> <span class="n">shift</span> <span class="n">them</span> <span class="n">to</span> <span class="n">Q10</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">band_length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">k</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">half_in2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">int32_t</span><span class="p">)</span><span class="n">in_data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">half_in1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">int32_t</span><span class="p">)</span><span class="n">in_data</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">All</span> <span class="k">pass</span> <span class="n">filter</span> <span class="n">even</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">samples</span><span class="p">,</span> <span class="n">independently</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebRtcSpl_AllPassQMF</span><span class="p">(</span><span class="n">half_in1</span><span class="p">,</span> <span class="n">band_length</span><span class="p">,</span> <span class="n">filter1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">WebRtcSpl_kAllPassFilter1</span><span class="p">,</span> <span class="n">filter_state1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebRtcSpl_AllPassQMF</span><span class="p">(</span><span class="n">half_in2</span><span class="p">,</span> <span class="n">band_length</span><span class="p">,</span> <span class="n">filter2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">WebRtcSpl_kAllPassFilter2</span><span class="p">,</span> <span class="n">filter_state2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">Take</span> <span class="n">the</span> <span class="n">sum</span> <span class="ow">and</span> <span class="n">difference</span> <span class="n">of</span> <span class="n">filtered</span> <span class="n">version</span> <span class="n">of</span> <span class="n">odd</span> <span class="ow">and</span> <span class="n">even</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">branches</span> <span class="n">to</span> <span class="n">get</span> <span class="n">upper</span> <span class="o">&amp;</span> <span class="n">lower</span> <span class="n">band</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">band_length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">filter2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">low_band</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">WebRtcSpl_SatW32ToW16</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">filter2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">high_band</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">WebRtcSpl_SatW32ToW16</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>上面是WebRTC中关于分析滤波器部分的实现，从代码中可以看出WebRTC中的分析综合滤波器是基于全通滤波器的QMF多相实现，其中的全通滤器采用了IIR实现，即其中的P0(z)和P1(z)都是全通滤波器。通过参考[2]我们可以梳理这个问题的处理流程，通过分析QMF分析综合滤波器满足完美重构的条件，可以得到H0、H1、G0、G1之间的关系，同时H0和H1是基于pi/2，因此只需要知道H0，最终转化成H0低通滤波器的设计问题。进一步的由于采用了基于IIR的全通滤波器，因此只需要考虑相位失真问题，最终QMF分析综合滤波器问题转换成了滤波器的相位均衡问题。虽然我们知道了设计QMF分析综合滤波器的原理和思路，但是想设计一个完全可用的滤波器还是很有难度的，下面我们直接看下WebRTC中QMF分析综合滤波器的效果，如下图所示，可以看到对应的低通滤波器和高通滤波器都有很窄的过渡带，整个系统的幅值响应几乎接近0dB的，同时除了pi/2附近的频带都是近似线性相位的。</p>
<!-- {% asset_img 007.png %} -->
<img src="/images/2022-02-03-007.png"/>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">scipy</span><span class="o">.</span><span class="k">signal</span> <span class="n">as</span> <span class="k">signal</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">numpy</span> <span class="n">as</span> <span class="n">np</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span> <span class="n">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">control</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">analysis_synthesis_filter</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter1_coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6418.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">36982.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">57261.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter2_coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">21333.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">49062.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">63010.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_0_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_0_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_1_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_1_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_2_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_2_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha1_0_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_0_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_1_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_1_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_2_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_2_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha0_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_2_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_1_b</span><span class="p">,</span> <span class="n">ha0_0_b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_2_a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_1_a</span><span class="p">,</span> <span class="n">ha0_0_a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_2_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_1_b</span><span class="p">,</span> <span class="n">ha1_0_b</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_2_a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_1_a</span><span class="p">,</span> <span class="n">ha1_0_a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha0_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">ha0_b</span><span class="p">,</span> <span class="n">ha0_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">ha1_b</span><span class="p">,</span> <span class="n">ha1_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b0_sys</span> <span class="o">=</span> <span class="n">ha1_sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">b1_sys</span> <span class="o">=</span> <span class="n">ha0_sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">delay_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_sys</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">+</span> <span class="n">ha1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_sys</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">-</span> <span class="n">ha1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_sys</span> <span class="o">=</span> <span class="n">delay_sys</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">*</span> <span class="n">b0_sys</span> <span class="o">+</span> <span class="n">ha1_sys</span> <span class="o">*</span> <span class="n">b1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(t_sys)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_num</span> <span class="o">=</span> <span class="n">lowpass_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_den</span> <span class="o">=</span> <span class="n">lowpass_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_num</span> <span class="o">=</span> <span class="n">highpass_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_den</span> <span class="o">=</span> <span class="n">highpass_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_num</span> <span class="o">=</span> <span class="n">t_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_den</span> <span class="o">=</span> <span class="n">t_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_w</span><span class="p">,</span> <span class="n">lowpass_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">lowpass_num</span><span class="p">,</span> <span class="n">lowpass_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_w</span><span class="p">,</span> <span class="n">highpass_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">highpass_num</span><span class="p">,</span> <span class="n">highpass_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_w</span><span class="p">,</span> <span class="n">t_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">t_num</span><span class="p">,</span> <span class="n">t_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lowpass_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">lowpass_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">highpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">highpass_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">highpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">highpass_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">t_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h1 id="最近的一些心得">最近的一些心得</h1>
<p>最后说下近期的两点小心得：</p>
<ol>
<li>不懂的知识点请尽早弄懂它。其实对于QMF分析综合滤波器组，在最开始学习音频编码时就遇到了，但是当时没有深入的去搞清楚，最后还是没有躲过去。所以最近也是恶补了很多基础知识，才大致了解了QMF的设计思路。</li>
<li>不断地输出也许是应对焦虑的一种方法。人到中年难免焦虑，就不停地去学习去吸收，但是往往又是很低效的，时间花了，却什么也没有留下。特别是现在这个信息爆炸的时代，各种信息流，碎片化阅读，让我们看起来收获了很多，其实什么也没有。其实我们要对自己是几平米的房子有基本的认知，小房子就应该放少的、小的东西，定期对房间进行整理，永远保持一定的空间的留白，才会有喘息和美的余地。</li>
</ol>
<h1 id="参考">参考</h1>
<ol>
<li>Book:《数字信号处理：理论、算法与应用》</li>
<li>Paper: 具有良好重建特性的正交镜像IIR滤波器组的设计新方法</li>
<li>Paper: IIR QMF-bank design for speech and audio subband coding</li>
<li>Blog: WebRTC VAD 中所用滤波器之分析_book_bbyuan的博客-CSDN博客</li>
</ol>]]></content:encoded>
    </item>
    <item>
      <title>WebRTC中的音频处理概览</title>
      <link>https://lyapple2008.github.io/posts/202112/2021-12-22-webrtc%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E5%A4%84%E7%90%86%E6%A6%82%E8%A7%88/</link>
      <pubDate>Sat, 22 Jan 2022 10:53:15 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/202112/2021-12-22-webrtc%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E5%A4%84%E7%90%86%E6%A6%82%E8%A7%88/</guid>
      <description>&lt;!-- {% asset_img 001.png %} --&gt;
&lt;img src=&#34;https://lyapple2008.github.io/images/2021-12-22-001.png&#34;/&gt;
&lt;p&gt;WebRTC由音频引擎、视频引擎和传输模块，音频处理在WebRTC占了很大一块，本文主要对WebRTC中涉及的音频处理进行简单介绍，不会对具体的实现进行介绍。上图是WebRTC中音频处理的流水线（上面的图是网上的图，如有侵权，通知即删），可以看出主要包含了音频采集播放、音频处理、音频编解码和音频传输。下面对这些模块逐一进行介绍。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<!-- {% asset_img 001.png %} -->
<img src="/images/2021-12-22-001.png"/>
<p>WebRTC由音频引擎、视频引擎和传输模块，音频处理在WebRTC占了很大一块，本文主要对WebRTC中涉及的音频处理进行简单介绍，不会对具体的实现进行介绍。上图是WebRTC中音频处理的流水线（上面的图是网上的图，如有侵权，通知即删），可以看出主要包含了音频采集播放、音频处理、音频编解码和音频传输。下面对这些模块逐一进行介绍。</p>
<h1 id="音频采集播放">音频采集播放</h1>
<p>自然界的声音，包括人说出来的声音，都是模拟信号，这些模拟信号是不能被计算机存储和识别的，也不能通过网络进行传输。音频采集就是声音从模拟信号转换成数字信号的过程，而音频播放就是声音从数字信号转换成模拟信号的过程。对于音频数字信号来说有以下几个最主要的参数：</p>
<ol>
<li>采样率
采样率是指录音设备在一秒钟内对声音信号的采样次数，单位是Hz，采样频率越高，声音的还原度越真实越自然。但是人耳可以听到的频度范围是20Hz~20000Hz，然后根据采样定理，也就是说最低只需要40kHz采样率就可以满足人耳的需求了，因此CD音质和音乐音频都是44.1kHz。但是采样率越高意味着数据量越大，因此在一些特殊的场景会使用更低的采样率，如语音通话场景，因为人声都是低于4kHz，因此在语音通话场景更多会使用8kHz或者16kHz的采样率。</li>
</ol>
<!-- {% asset_img 002.png %} -->
<img src="/images/2021-12-22-002.png"/>
<ol start="2">
<li>采样位宽
声音模拟信号经过采样后得一个个样点的值，这个值需要存储到计算机中，那么使用多少位数来表示这个 就是采样位宽，通常使用最多的是16bit，正好就是一个short类型。</li>
<li>声道数
在使用录音设备进行声音采集时，只能表示到采集点处的声音信号，但是实际声音是有空间信息，为了表达声音的空间信息，就有了声道的概念。这里最有名的可能就是杜比全景声了，大家在电影院看电影的时候，感受到的被声音包围的真实感就是多声道的功劳了，当然这里并不是加多几个通道这么简单啦。</li>
</ol>
<!-- {% asset_img 003.png %} -->
<img src="/images/2021-12-22-003.png"/>
<h1 id="音频编解码">音频编解码</h1>
<p>虽然音频的数据量没有视频的量那么大，但是如果直接传输原始的音频数据（原始的音频数据有个名字叫Pulse Code Modulation (PCM)），数据量也是挺大的。现在我们来计算下1秒采样率为48kHz双通道的音频信号的数据量有多大，1秒 * 48000个采样点 * 2个声道 * 每个样点2Bytes，这样1秒的数据量是192kB字节。这样的数据量在互联网发展的早期也是不可以接受的，这时候就需要音频编解码。简单的说，音频编解码就是利用人耳的心理声学特性将也一些不影响听觉的信号丢弃，从而减少信号量的方法，在WebRTC中用得最多的是Opus格式。对于音频编码器来说一个很重要的参数是码率，单位是kbps，即每秒的音频使用多少bits位来表示。音频编解码是音频领域一个很专业的领域，这里就不展开了。</p>
<h1 id="音频处理">音频处理</h1>
<p>在实时通话场景，需要面对各种复杂的环境，处理各种音频问题，最常见的如噪声、回声、声音过大过小等，WebRTC中有一个专门的音频处理模块来处理这些问题，下面就简单介绍下这些模块。</p>
<ol>
<li>回声消除（Acoustic Echo Cancellation）
实际通话场景是一个全双工通信系统非容易产生回声，如下图所示，远端说话声==》近端扬声器播放==》近端麦克风录制==》通过网络传输到远端的扬声器播放，经过这样一个音频环路后，远端又在扬声器里听到自己的声音，也就是回声，如果回声的延时很低时还会产生啸叫，这样是很影响通话体验的。这时就需要回声消除AEC模块了，通常录音数据都会先经过个模块，在传输前先把远端播放的数据消除，这样远端在播放的时候就不会听到回声了。回声消除AEC详细的原理介绍留到后面再介绍，这里先挖个坑。</li>
</ol>
<!-- {% asset_img 004.png %} -->
<img src="/images/2021-12-22-004.png"/>
<ol start="2">
<li>噪声抑制（Noise Suppression）
噪声抑制NS这个很好理解，实际的通话场景都会存在各种各样的噪声，为了保证通话体验不受影响，这时就需要噪声抑制NS模块了。这里也再挖一坑，后面再根据WebRTC源码进行噪声抑制原理介绍。</li>
<li>自动增益控制（Auto Gain Control）
在实际通话过程中，由于使用设备的差异和通话时离麦克风的远近，导致了通话的音量差异，为了达到统一的体验就需要进行自动增益控制，简单说就是当音量小时调大增益，当音量大时调小增益，达到减少音量起伏的作用。</li>
<li>混音（Mix）
在多人通话场景下，我们需要接收和播放的通常不止一条音频流，但通常只有一个播放设备，因此通常需要对多条音频流先进行混音操作，再进行播放。</li>
</ol>
<h1 id="音频传输">音频传输</h1>
<p>目前WebRTC音频传输是UDP/RTP/RTCP协议基础上进行传输的，底层UDP协议的不可靠性，导致丢包不可避免，同时音频数据与其它的数据内容有其特殊性，通常一点音频异常都很容易被人感知出来。因此WebRTC针对音频传输做了很多额外的工作，除了最常见的丢包重传，丢包补偿等，还有一个NetEQ模块，会在播放端进行音频播放的加减速来进一步减少由于网络抖动引起的音频异常。</p>
<!-- {% asset_img 005.png %} -->
<img src="/images/2021-12-22-005.png"/>
<p>到这里WebRTC中跟音频相关的技术模块都简单的过了一遍，这样大家对于WebRTC音频处理有个大概的印象，这里的每个模块值得深入去学习，后面也把自己学习的一些心得记录在这里，大家一起学习呀。</p>]]></content:encoded>
    </item>
    <item>
      <title>收集音频技术应用公司与实验室</title>
      <link>https://lyapple2008.github.io/posts/201810/2018-10-29-%E6%94%B6%E9%9B%86%E9%9F%B3%E9%A2%91%E6%8A%80%E6%9C%AF%E5%BA%94%E7%94%A8%E5%85%AC%E5%8F%B8%E4%B8%8E%E5%AE%9E%E9%AA%8C%E5%AE%A4/</link>
      <pubDate>Mon, 29 Oct 2018 23:34:05 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/201810/2018-10-29-%E6%94%B6%E9%9B%86%E9%9F%B3%E9%A2%91%E6%8A%80%E6%9C%AF%E5%BA%94%E7%94%A8%E5%85%AC%E5%8F%B8%E4%B8%8E%E5%AE%9E%E9%AA%8C%E5%AE%A4/</guid>
      <description>&lt;!-- ![](https://user-images.githubusercontent.com/3350865/61180076-fe89b200-a642-11e9-81a7-697446a0860a.jpg)    --&gt;
&lt;p&gt;&lt;img alt=&#34;Image Caption&#34; loading=&#34;lazy&#34; src=&#34;https://lyapple2008.github.io/images/2018-10-29-001.jpg&#34;&gt;&lt;/p&gt;
&lt;p&gt;  收集一些音频相关的公司和实验室，另外还有一些个人博客，用来了解行业的最新动态。&lt;/p&gt;</description>
      <content:encoded><![CDATA[<!-- ![](https://user-images.githubusercontent.com/3350865/61180076-fe89b200-a642-11e9-81a7-697446a0860a.jpg)    -->
<p><img alt="Image Caption" loading="lazy" src="/images/2018-10-29-001.jpg"></p>
<p>  收集一些音频相关的公司和实验室，另外还有一些个人博客，用来了解行业的最新动态。</p>
<ul>
<li>
<h2 id="技术公司">技术公司</h2>
</li>
</ul>
<ol>
<li><a href="https://www.smule.com/apps">smule</a> 一些乐器应用挺有意思的</li>
<li><a href="https://www.soundhound.com/soundhound">SoundHound</a> 哼唱歌曲识别</li>
<li><a href="http://www.vocaloid.com/en/">Vocaloid</a>   歌声合成</li>
<li><a href="http://www.gracenote.com/">Gracenote</a></li>
</ol>
<ul>
<li>
<h2 id="实验室">实验室</h2>
</li>
</ul>
<ol>
<li><a href="http://music.cs.northwestern.edu/">Interactive audio lab</a></li>
<li><a href="https://www.upf.edu/web/mtg">Music Technology Group</a></li>
<li><a href="http://naplab.ee.columbia.edu/">Neural Acoustic Processing Lab</a></li>
<li><a href="http://marg.snu.ac.kr/">Music and Audio Research Group, Seoul National University
</a></li>
</ol>
<ul>
<li>
<h2 id="个人博客">个人博客</h2>
</li>
</ul>
<ol>
<li><a href="http://www.justinsalamon.com/melody-extraction.html">Melody Extraction</a></li>
<li><a href="http://www.cs.cmu.edu/~yunwang/">Yun Wang (Maigo)</a></li>
</ol>
<ul>
<li>
<h2 id="开源库">开源库</h2>
</li>
</ul>
<ol>
<li><a href="http://essentia.upf.edu/documentation/">Essentia</a></li>
</ol>]]></content:encoded>
    </item>
  </channel>
</rss>
