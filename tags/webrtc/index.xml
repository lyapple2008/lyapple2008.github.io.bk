<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>WebRTC on BeYoung</title>
    <link>https://lyapple2008.github.io/tags/webrtc/</link>
    <description>Recent content in WebRTC on BeYoung</description>
    <image>
      <title>BeYoung</title>
      <url>https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://lyapple2008.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.152.2</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 Â·</copyright>
    <lastBuildDate>Mon, 07 Jul 2025 21:59:22 +0800</lastBuildDate>
    <atom:link href="https://lyapple2008.github.io/tags/webrtc/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>WebRTCè¯­éŸ³é™å™ªä¹‹Wieneræ»¤æ³¢</title>
      <link>https://lyapple2008.github.io/posts/202507/2025-07-13-webrtc%E8%AF%AD%E9%9F%B3%E9%99%8D%E5%99%AA%E4%B9%8Bwiener%E6%BB%A4%E6%B3%A2/</link>
      <pubDate>Mon, 07 Jul 2025 21:59:22 +0800</pubDate>
      <guid>https://lyapple2008.github.io/posts/202507/2025-07-13-webrtc%E8%AF%AD%E9%9F%B3%E9%99%8D%E5%99%AA%E4%B9%8Bwiener%E6%BB%A4%E6%B3%A2/</guid>
      <description>&lt;h1 id=&#34;webrtcä¸­çš„wieneræ»¤æ³¢é™å™ªç®—æ³•&#34;&gt;WebRTCä¸­çš„Wieneræ»¤æ³¢é™å™ªç®—æ³•&lt;/h1&gt;
&lt;h2 id=&#34;å¼•è¨€&#34;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨å®æ—¶è¯­éŸ³é€šä¿¡ç³»ç»Ÿä¸­ï¼ŒèƒŒæ™¯å™ªå£°çš„æŠ‘åˆ¶å¯¹äºæå‡é€šè¯æ¸…æ™°åº¦è‡³å…³é‡è¦ã€‚Google çš„ WebRTC é¡¹ç›®åœ¨å…¶å¼€æºè¯­éŸ³å¼•æ“ä¸­å®ç°äº†é«˜è´¨é‡çš„è¯­éŸ³é™å™ªæ¨¡å—ï¼Œå…¶ä¸­ Wiener æ»¤æ³¢å™¨ä½œä¸ºæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œç»“åˆè¯­éŸ³æ¦‚ç‡ä¼°è®¡ã€å¤šç‰¹å¾å»ºæ¨¡ã€å™ªå£°è°±è·Ÿè¸ªç­‰æ¨¡å—æ„å»ºäº†ä¸€ä¸ªé«˜åº¦å®ç”¨çš„å¢å¼ºæ¡†æ¶ã€‚&lt;/p&gt;</description>
      <content:encoded><![CDATA[<h1 id="webrtcä¸­çš„wieneræ»¤æ³¢é™å™ªç®—æ³•">WebRTCä¸­çš„Wieneræ»¤æ³¢é™å™ªç®—æ³•</h1>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>åœ¨å®æ—¶è¯­éŸ³é€šä¿¡ç³»ç»Ÿä¸­ï¼ŒèƒŒæ™¯å™ªå£°çš„æŠ‘åˆ¶å¯¹äºæå‡é€šè¯æ¸…æ™°åº¦è‡³å…³é‡è¦ã€‚Google çš„ WebRTC é¡¹ç›®åœ¨å…¶å¼€æºè¯­éŸ³å¼•æ“ä¸­å®ç°äº†é«˜è´¨é‡çš„è¯­éŸ³é™å™ªæ¨¡å—ï¼Œå…¶ä¸­ Wiener æ»¤æ³¢å™¨ä½œä¸ºæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œç»“åˆè¯­éŸ³æ¦‚ç‡ä¼°è®¡ã€å¤šç‰¹å¾å»ºæ¨¡ã€å™ªå£°è°±è·Ÿè¸ªç­‰æ¨¡å—æ„å»ºäº†ä¸€ä¸ªé«˜åº¦å®ç”¨çš„å¢å¼ºæ¡†æ¶ã€‚</p>
<p>æœ¬æ–‡å°†ä» Wiener æ»¤æ³¢ç†è®ºå…¥æ‰‹ï¼Œé€æ­¥è§£æ WebRTC ä¸­è¯¥ç®—æ³•çš„å·¥ç¨‹å®ç°ï¼Œå…¶ä¸­å™ªå£°ä¼°è®¡æ¨¡å—å’Œè¯­éŸ³æ¦‚ç‡ä¼°è®¡æ¨¡å—å·²ç»åœ¨ä¹‹å‰ä»‹ç»äº†ï¼Œæœ‰éœ€è¦çš„å¯ä»¥ç¿»é˜…ã€‚</p>
<h2 id="ä¸€wieneræ»¤æ³¢åŸºç¡€">ä¸€ã€Wieneræ»¤æ³¢åŸºç¡€</h2>
<p>Wiener æ»¤æ³¢å™¨æ˜¯ä¸€ç§æœ€å°å‡æ–¹è¯¯å·®ï¼ˆMMSEï¼‰ä¼°è®¡å™¨ï¼Œåœ¨é¢‘åŸŸé™å™ªä¸­ç”¨äºæ„é€ ä¸€ä¸ªé¢‘ç‚¹å¢ç›Šå‡½æ•°ï¼Œä»¥æœ€å¤§ç¨‹åº¦è¿˜åŸè¯­éŸ³ä¿¡å·ã€‚</p>
<p>å…¶åŸºæœ¬å½¢å¼ä¸ºï¼š</p>
<p>$$
G(f) = \frac{\xi(f)}{\xi(f) + 1}
$$</p>
<p>å…¶ä¸­ï¼š
â€¢	$\xi(f)$ï¼šå…ˆéªŒä¿¡å™ªæ¯”ï¼ˆprior SNRï¼‰
â€¢	$G(f)$ï¼šé¢‘ç‡ç‚¹ f çš„ Wiener å¢ç›Š</p>
<p>æ­¤å¢ç›Šç”¨äºå¯¹è¾“å…¥é¢‘è°±è¿›è¡Œç¼©æ”¾ï¼Œä»è€Œæ»¤é™¤å™ªå£°æˆåˆ†ã€‚</p>
<h2 id="äºŒwebrtcä¸­çš„wieneræ»¤æ³¢ç»“æ„">äºŒã€WebRTCä¸­çš„Wieneræ»¤æ³¢ç»“æ„</h2>
<p>åœ¨ WebRTC é™å™ªæ¨¡å—ä¸­ï¼ŒWiener æ»¤æ³¢ä¸æ˜¯å­¤ç«‹è¿è¡Œï¼Œè€Œæ˜¯é›†æˆåœ¨ä¸€å¥—å®Œæ•´çš„å™ªå£°ä¼°è®¡ä¸è¯­éŸ³æ¦‚ç‡å»ºæ¨¡æ¡†æ¶ä¸­ï¼š</p>

<div class="mermaid">graph TD
    A[è¾“å…¥éŸ³é¢‘å¸§] --&gt; B[STFT åˆ†å¸§]
    B --&gt; C[ä¿¡å·è°± &#43; å™ªå£°è°±]
    C --&gt; D[SNRä¼°è®¡ï¼ˆåéªŒ&#43;å…ˆéªŒï¼‰]
    C --&gt; E[LRT / Flatness / Diff ç‰¹å¾æå–]
    D &amp; E --&gt; F[Wiener æ»¤æ³¢å¢ç›Šè®¡ç®—]
    F --&gt; G[åŸºäºè¯­éŸ³æ¦‚ç‡å¾®è°ƒå¢ç›Š]
    G --&gt; H[é¢‘è°±ä¹˜ä»¥å¢ç›Šåé€†å˜æ¢]
    H --&gt; I[è¾“å‡ºå¢å¼ºè¯­éŸ³]</div>
<h2 id="ä¸‰æ ¸å¿ƒå¢ç›Šè®¡ç®—é€»è¾‘">ä¸‰ã€æ ¸å¿ƒå¢ç›Šè®¡ç®—é€»è¾‘</h2>
<ol>
<li>åéªŒSNRä¸å…ˆéªŒSNRä¼°è®¡
â€¢	åéªŒSNRï¼šä½¿ç”¨å½“å‰å¸§ä¿¡å·è°±ä¸å™ªå£°è°±ä¹‹æ¯”
â€¢	å…ˆéªŒSNRï¼š</li>
</ol>
<p>$$
\xi_t(f) = \alpha \cdot \frac{|S_{t-1}(f)|^2}{N_{t-1}(f)} + (1 - \alpha) \cdot \max(\gamma_t(f) - 1, 0)
$$</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">    <span class="c1">// Previous estimate based on previous frame with gain filter.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">prev_tsa</span> <span class="o">=</span> <span class="n">spectrum_prev_process_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span>
</span></span><span class="line"><span class="cl">                     <span class="p">(</span><span class="n">prev_noise_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0001f</span><span class="p">)</span> <span class="o">*</span> <span class="n">filter_</span><span class="p">[</span><span class="n">i</span><span class="p">];</span></span></span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>spectrum_prev_process_[i] ä¸ºå‰ä¸€å¸§ä¿¡å·çš„å¹…åº¦è°±ï¼Œfilter_[i]ä¸ºå‰å¸§çš„Wieneræ»¤æ³¢å™¨å¢ç›Šï¼Œä¸¤è€…ç›¸ä¹˜åå°±æ˜¯ä¼°è®¡çš„çº¯å‡€è¯­éŸ³ä¿¡å·ï¼Œå› æ­¤prev_tsaå°±æ˜¯å‰ä¸€å¸§çš„TSA (time-smoothed a priori SNR)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">    <span class="c1">// Post SNR.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">noise_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">post_snr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">noise_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0001f</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">post_snr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>åªæœ‰å½“ä¿¡å·å¹…åº¦å¤§äºå™ªå£°å¹…åº¦æ—¶ï¼Œæ‰è®¤ä¸ºæœ‰è¯­éŸ³ä¿¡å·å­˜åœ¨ï¼Œé¿å…è´Ÿå¢ç›Š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="n">prior_snr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.98f</span> <span class="o">*</span> <span class="n">prev_estimate</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.f</span> <span class="o">-</span> <span class="mf">0.98f</span><span class="p">)</span> <span class="o">*</span> <span class="n">post_snr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span></span></span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>0.98 æ˜¯å¹³æ»‘å› å­ï¼Œè¡¨ç¤ºä»¥å†å²å…ˆéªŒä¼°è®¡ä¸ºä¸»ï¼Œé˜²æ­¢çªå˜</p>
</blockquote>
<ol start="2">
<li>åŸºæœ¬å¢ç›Šè®¡ç®—</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">    <span class="c1">// å‚å˜ç»´çº³æ»¤æ³¢å™¨ï¼Œå‚è€ƒã€Šè¯­éŸ³å¢å¼º--ç†è®ºä¸å®è·µã€‹,é€šè¿‡over_subtraction_factoræ¥æ§åˆ¶é™å™ªåŠ›åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">filter_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="n">snr_prior</span> <span class="o">/</span> <span class="p">(</span><span class="n">suppression_params_</span><span class="p">.</span><span class="n">over_subtraction_factor</span> <span class="o">+</span> <span class="n">snr_prior</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="nf">max</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="nf">min</span><span class="p">(</span><span class="n">filter_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.f</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                          <span class="n">suppression_params_</span><span class="p">.</span><span class="n">minimum_attenuating_gain</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<img src="/images/2025-07-13/wiener_over_subtraction_factor.png"/>
<h2 id="å››å¢ç›Šå¾®è°ƒè¯­éŸ³æ¦‚ç‡è¾…åŠ©å› å­">å››ã€å¢ç›Šå¾®è°ƒï¼šè¯­éŸ³æ¦‚ç‡è¾…åŠ©å› å­</h2>
<p>è™½ç„¶ Wiener æ»¤æ³¢å™¨ç†è®ºä¸Šæ˜¯æœ€ä¼˜çš„ï¼Œä½†å…¶åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä»å­˜åœ¨é—®é¢˜ï¼š
â€¢	SNR ä¼°è®¡ä¸å‡†ç¡®
â€¢	ç¼ºä¹ä¸Šä¸‹æ–‡åˆ¤æ–­
â€¢	è¯­éŸ³å°¾éŸ³æ˜“è¢«åæ‰</p>
<p>å› æ­¤ WebRTC å¼•å…¥äº†è¯­éŸ³æ¦‚ç‡ä¼°è®¡æ¨¡å—ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å¾®è°ƒ Wiener å¢ç›Šï¼š</p>
<p>scale = prior_prob * scale1 + (1 - prior_prob) * scale2;</p>
<p>å…¶ä¸­ï¼š
â€¢	scale1: å½“å‰æ˜¯è¯­éŸ³ â†’ å¢å¼ºå¢ç›Š
â€¢	scale2: å½“å‰æ˜¯å™ªå£° â†’ æŠ‘åˆ¶å¢ç›Š
â€¢	prior_prob: é€šè¿‡ LRTã€Spectral Flatnessã€Spectral Diff ç­‰ç‰¹å¾ç»¼åˆä¼°è®¡</p>
<h2 id="äº”é«˜å¸¦å¤„ç†">äº”ã€é«˜å¸¦å¤„ç†</h2>
<p>åœ¨WebRTCçš„å™ªå£°æŠ‘åˆ¶ç®—æ³•ä¸­ï¼Œé«˜é¢‘å¸¦ï¼ˆ8kHzä»¥ä¸Šï¼‰æ²¡æœ‰ç›´æ¥ä½¿ç”¨é¢‘åŸŸWieneræ»¤æ³¢å¤„ç†ï¼Œè€Œæ˜¯åœ¨æ—¶åŸŸç»Ÿä¸€å¢ç›Šå¤„ç†ï¼Œè¿™é‡Œå³æ˜¯å› ä¸ºè¯­éŸ³å¤§éƒ¨åˆ†æ˜¯åœ¨ä½å¸¦éƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†æ•ˆç‡å‡å°‘è®¡ç®—é‡ã€‚æ¥ä¸‹æˆ‘ä»¬æ¥åˆ†æWebRTCçš„å™ªå£°æŠ‘åˆ¶ç®—æ³•æ˜¯å¦‚ä½•é€šè¿‡ä½å¸¦çš„ä¿¡æ¯è®¡ç®—é«˜é¢‘å¸¦å¢ç›Šçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// Computes the attenuating gain for the noise suppression of the upper bands.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">float</span> <span class="nf">ComputeUpperBandsGain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">minimum_attenuating_gain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">filter</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">speech_probability</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">prev_analysis_signal_spectrum</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">signal_spectrum</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Average speech prob and filter gain for the end of the lowest band.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">constexpr</span> <span class="kt">int</span> <span class="n">kNumAvgBins</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kOneByNumAvgBins</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">/</span> <span class="n">kNumAvgBins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è®¡ç®—ä½å¸¦ä¸­æœ€åçš„çš„kNumAvgBinsä¸ªé¢‘ç‚¹ï¼ˆé è¿‘8kHzé™„è¿‘ï¼‰çš„å¹³å‡è¯­éŸ³æ¦‚ç‡å’Œå¹³å‡å¢ç›Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">avg_prob_speech</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">avg_filter_gain</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="n">kFftSizeBy2Plus1</span> <span class="o">-</span> <span class="n">kNumAvgBins</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg_prob_speech</span> <span class="o">+=</span> <span class="n">speech_probability</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg_filter_gain</span> <span class="o">+=</span> <span class="n">filter</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">avg_prob_speech</span> <span class="o">=</span> <span class="n">avg_prob_speech</span> <span class="o">*</span> <span class="n">kOneByNumAvgBins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">avg_filter_gain</span> <span class="o">=</span> <span class="n">avg_filter_gain</span> <span class="o">*</span> <span class="n">kOneByNumAvgBins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// If the speech was suppressed by a component between Analyze and Process, an
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// example being by an AEC, it should not be considered speech for the purpose
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// of high band suppression. To that end, the speech probability is scaled
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// accordingly.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">sum_analysis_spectrum</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">sum_processing_spectrum</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum_analysis_spectrum</span> <span class="o">+=</span> <span class="n">prev_analysis_signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum_processing_spectrum</span> <span class="o">+=</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// The magnitude spectrum computation enforces the spectrum to be strictly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// positive.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">RTC_DCHECK_GT</span><span class="p">(</span><span class="n">sum_analysis_spectrum</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">avg_prob_speech</span> <span class="o">*=</span> <span class="n">sum_processing_spectrum</span> <span class="o">/</span> <span class="n">sum_analysis_spectrum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Compute gain based on speech probability.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">gain</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="mf">0.5f</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.f</span> <span class="o">+</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="nf">tanh</span><span class="p">(</span><span class="mf">2.f</span> <span class="o">*</span> <span class="n">avg_prob_speech</span> <span class="o">-</span> <span class="mf">1.f</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Combine gain with low band gain.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">avg_prob_speech</span> <span class="o">&gt;=</span> <span class="mf">0.5f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">gain</span> <span class="o">=</span> <span class="mf">0.25f</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="mf">0.75f</span> <span class="o">*</span> <span class="n">avg_filter_gain</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">gain</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">avg_filter_gain</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Make sure gain is within flooring range.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="nf">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="nf">max</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">minimum_attenuating_gain</span><span class="p">),</span> <span class="mf">1.f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ol>
<li>é€‰å–ä½å¸¦é¢‘è°±ä¸­æœ€å32ä¸ªbinï¼ˆå³é è¿‘8kHzçš„éƒ¨åˆ†ï¼‰ï¼Œè®¡ç®—å¹³å‡è¯­éŸ³æ¦‚ç‡å’Œå¹³å‡Wieneræ»¤æ³¢å™¨å¢ç›Š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">avg_prob_speechï¼šè¯­éŸ³å­˜åœ¨çš„å¯èƒ½æ€§ï¼ˆ0~1ï¼‰
</span></span><span class="line"><span class="cl">avg_filter_gainï¼šä½å¸¦æœ€åæ®µçš„å¢ç›Šï¼ˆä»£è¡¨é¢‘è°±é«˜é¢‘å˜åŒ–ï¼‰</span></span></code></pre></td></tr></table>
</div>
</div>
<ol start="2">
<li>å¤„ç†å‰åè°±èƒ½é‡æ¯”ä¿®æ­£è¯­éŸ³æ¦‚ç‡</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="n">avg_prob_speech</span> <span class="o">*=</span> <span class="n">sum_processing_spectrum</span> <span class="o">/</span> <span class="n">sum_analysis_spectrum</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>sum_analysis_spectrumï¼šåˆ†æé˜¶æ®µçš„è°±ï¼ˆåŸå§‹ noisy è¯­éŸ³ï¼‰</li>
<li>sum_processing_spectrumï¼šå¤„ç†é˜¶æ®µçš„è°±ï¼ˆå¯èƒ½è¢« AECã€AGC ç­‰å¤„ç†ï¼‰
âš ï¸ å¦‚æœè¯­éŸ³ä¿¡å·è¢«å…¶ä»–æ¨¡å—ï¼ˆæ¯”å¦‚å›å£°æ¶ˆé™¤ï¼‰å‰Šå¼±äº†ï¼Œè€Œä¼°è®¡å™¨æ²¡æ³¨æ„åˆ°ï¼Œå°±ä¼šè¿‡åº¦æŠ‘åˆ¶é«˜å¸¦ï¼Œè¿™é‡Œé€šè¿‡èƒ½é‡æ¯”è¿›è¡Œä¿®æ­£ï¼Œé˜²æ­¢â€œå‡é™éŸ³â€å½±å“é«˜é¢‘å‹åˆ¶åˆ¤æ–­ã€‚</li>
</ul>
<ol start="3">
<li>ä½¿ç”¨ tanh å¹³æ»‘æ˜ å°„ä¸ºå¢ç›Šå› å­</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="n">gain</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.f</span> <span class="o">+</span> <span class="nf">tanh</span><span class="p">(</span><span class="mf">2.f</span> <span class="o">*</span> <span class="n">avg_prob_speech</span> <span class="o">-</span> <span class="mf">1.f</span><span class="p">));</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>tanh å‡½æ•°åšäº†ä¸€ä¸ªSå‹æ˜ å°„ï¼šä½¿å¾— 01 çš„ avg_prob_speech æ˜ å°„ä¸º 01 çš„å¢ç›Šï¼Œä½†ä¸­å¿ƒæ›´æ•æ„Ÿï¼Œå¹³æ»‘ã€å¯å¯¼ã€‚</li>
<li>å½“è¯­éŸ³æ¦‚ç‡é«˜äº 0.5 æ—¶å¢ç›Šå¿«é€Ÿä¸Šå‡ï¼›ä½äº 0.5 æ—¶å¿«é€Ÿä¸‹é™ã€‚</li>
</ul>
<ol start="4">
<li>å°†è¯¥å¢ç›Šå’Œä½å¸¦å¹³å‡æ»¤æ³¢å™¨å¢ç›Šèåˆ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">avg_prob_speech</span> <span class="o">&gt;=</span> <span class="mf">0.5f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">gain</span> <span class="o">=</span> <span class="mf">0.25f</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="mf">0.75f</span> <span class="o">*</span> <span class="n">avg_filter_gain</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="n">gain</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">avg_filter_gain</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>å½“è¯­éŸ³æ¦‚ç‡è¾ƒé«˜ï¼Œä»¥ä½å¸¦æ»¤æ³¢å™¨ä¸ºä¸»ï¼ˆå¼ºè°ƒä¿ç•™è¯­éŸ³çš„é«˜é¢‘ç‰¹å¾ï¼‰</li>
<li>å½“è¯­éŸ³æ¦‚ç‡è¾ƒä½ï¼Œç”¨æ¦‚ç‡å¢ç›Šå’Œæ»¤æ³¢å¢ç›Šå„ä¸€åŠæƒé‡</li>
</ul>
<ol start="5">
<li>é«˜å¸¦å»¶æ—¶å¤„ç†</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="nf">DelaySignal</span><span class="p">(</span><span class="n">y_band</span><span class="p">,</span> <span class="n">channels_</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">process_delay_memory</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">delayed_frame</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>ä½å¸¦ç”±äºæ»¤æ³¢å™¨ç»„åˆ†æâ†’åˆæˆï¼Œä¼šäº§ç”Ÿç³»ç»Ÿå»¶æ—¶ï¼Œå› æ­¤åœ¨ä½å¸¦å’Œé«˜å¸¦åˆæˆå‰ï¼Œéœ€è¦å°†é«˜å¸¦ä¿¡å·è¿›è¡Œå»¶æ—¶æ“ä½œï¼Œä¸ä½å¸¦ä¿¡å·è¿›è¡Œå¯¹é½ã€‚</p>
<h2 id="å…­å°ç»“ä¸å¯å‘">å…­ã€å°ç»“ä¸å¯å‘</h2>
<p>WebRTC çš„ Wiener é™å™ªæ¨¡å—ä½“ç°äº†â€œç†è®º + å·¥ç¨‹â€çš„å®Œç¾ç»“åˆï¼š</p>
<table>
  <thead>
      <tr>
          <th>æ¨¡å—</th>
          <th>åŠŸèƒ½</th>
          <th>å·¥ç¨‹ä¼˜åŒ–</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Wiener å¢ç›Š</td>
          <td>é™å™ªæ ¸å¿ƒ</td>
          <td>åŠ å…¥å…ˆéªŒå¹³æ»‘ä¸æ¦‚ç‡è°ƒèŠ‚</td>
      </tr>
      <tr>
          <td>SNRä¼°è®¡</td>
          <td>æ”¯æŒå¢ç›Šè®¡ç®—</td>
          <td>TSAå¹³æ»‘ï¼Œé¿å…çªå˜</td>
      </tr>
      <tr>
          <td>è¯­éŸ³æ¦‚ç‡</td>
          <td>å¢ç›Šå¾®è°ƒ</td>
          <td>ä¸‰ç‰¹å¾èåˆ + Sigmoid æ˜ å°„</td>
      </tr>
      <tr>
          <td>å™ªå£°è°±ä¼°è®¡</td>
          <td>ä¿è¯å‡†ç¡®æ€§</td>
          <td>åˆ†ä½æ•°ä¼°è®¡ + å¯åŠ¨æ¨¡å‹</td>
      </tr>
  </tbody>
</table>
<p>è¿™ç§è®¾è®¡ä¿è¯äº†ç®—æ³•åœ¨å®æ—¶è¯­éŸ³åœºæ™¯ä¸­çš„é²æ£’æ€§ã€ç¨³å®šæ€§ä¸å¯å¬æ„Ÿæå‡æ•ˆæœã€‚</p>
<img src="/images/To-Be-Continued.jpeg"/>
]]></content:encoded>
    </item>
    <item>
      <title>WebRTCè¯­éŸ³é™å™ªä¹‹è¯­éŸ³æ¦‚ç‡ä¼°è®¡</title>
      <link>https://lyapple2008.github.io/posts/202506/2025-06-30-%E8%AF%AD%E9%9F%B3%E6%A6%82%E7%8E%87%E4%BC%B0%E8%AE%A1/</link>
      <pubDate>Mon, 30 Jun 2025 21:36:39 +0800</pubDate>
      <guid>https://lyapple2008.github.io/posts/202506/2025-06-30-%E8%AF%AD%E9%9F%B3%E6%A6%82%E7%8E%87%E4%BC%B0%E8%AE%A1/</guid>
      <description>&lt;p&gt;WebRTCçš„è¯­éŸ³é™å™ªç®—æ³•ä¸­å®ç°äº†ä¸€ä¸ªé¢‘ç‚¹ç»´åº¦çš„è¯­éŸ³æ¦‚ç‡ä¼°è®¡å™¨SpeechProbabilityEstimatorï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå¤šç‰¹å¾èåˆçš„çº¿æ€§åˆ†ç±»å™¨ã€‚ç»Ÿè®¡è®¡ç®—ä»¥ä¸‹ä¸‰ç§ç‰¹å¾ï¼Œ&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>WebRTCçš„è¯­éŸ³é™å™ªç®—æ³•ä¸­å®ç°äº†ä¸€ä¸ªé¢‘ç‚¹ç»´åº¦çš„è¯­éŸ³æ¦‚ç‡ä¼°è®¡å™¨SpeechProbabilityEstimatorï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå¤šç‰¹å¾èåˆçš„çº¿æ€§åˆ†ç±»å™¨ã€‚ç»Ÿè®¡è®¡ç®—ä»¥ä¸‹ä¸‰ç§ç‰¹å¾ï¼Œ</p>
<ul>
<li>LRT</li>
<li>Spectral Flatness  è°±å¹³å¦åº¦</li>
<li>Spectral Difference è°±å·®</li>
</ul>
<p>é€šè¿‡tanhå°†ç‰¹å¾å˜åŒ–æ˜ å°„åˆ°æ¦‚ç‡å€¼ï¼Œä½¿ç”¨ä¸åŒçš„widthå‚æ•°æ¥è°ƒèŠ‚æ•æ„Ÿåº¦ï¼Œçº¿æ€§åŠ æƒèåˆåˆ°å¾—æœ€ç»ˆçš„è¯­éŸ³æ¦‚ç‡ã€‚
æ¥ä¸‹æ¥å®Œæ•´åˆ†æ WebRTC ä¸­ç”¨äºè¯­éŸ³æ¦‚ç‡ä¼°è®¡çš„ä¸‰ä¸ªæ ¸å¿ƒç‰¹å¾ï¼ˆindicator0, indicator1, indicator2ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># ä»£ç ä½ç½®</span>
</span></span><span class="line"><span class="cl"><span class="n">modules</span><span class="o">/</span><span class="n">audio_processing</span><span class="o">/</span><span class="n">ns</span><span class="o">/</span><span class="n">speech_probability_estimator</span><span class="o">.</span><span class="n">h</span>
</span></span><span class="line"><span class="cl"><span class="n">modules</span><span class="o">/</span><span class="n">audio_processing</span><span class="o">/</span><span class="n">ns</span><span class="o">/</span><span class="n">speech_probability_estimator</span><span class="o">.</span><span class="n">cc</span>
</span></span><span class="line"><span class="cl"><span class="n">modules</span><span class="o">/</span><span class="n">audio_processing</span><span class="o">/</span><span class="n">ns</span><span class="o">/</span><span class="n">signal_model_estimator</span><span class="o">.</span><span class="n">cc</span>
</span></span><span class="line"><span class="cl"><span class="n">modules</span><span class="o">/</span><span class="n">audio_processing</span><span class="o">/</span><span class="n">ns</span><span class="o">/</span><span class="n">signal_model_estimator</span><span class="o">.</span><span class="n">h</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="indicator0-likelihood-ratio-test-lrt">indicator0: Likelihood Ratio Test (LRT)</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// Updates the log LRT measures.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">UpdateSpectralLrt</span><span class="p">(</span><span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">prior_snr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">post_snr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">avg_log_lrt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="kt">float</span><span class="o">*</span> <span class="n">lrt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">RTC_DCHECK</span><span class="p">(</span><span class="n">lrt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">tmp1</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">+</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">prior_snr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">tmp2</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">prior_snr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmp1</span> <span class="o">+</span> <span class="mf">0.0001f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">bessel_tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">post_snr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.f</span><span class="p">)</span> <span class="o">*</span> <span class="n">tmp2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg_log_lrt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span>
</span></span><span class="line"><span class="cl">        <span class="mf">.5f</span> <span class="o">*</span> <span class="p">(</span><span class="n">bessel_tmp</span> <span class="o">-</span> <span class="nf">LogApproximation</span><span class="p">(</span><span class="n">tmp1</span><span class="p">)</span> <span class="o">-</span> <span class="n">avg_log_lrt</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">log_lrt_time_avg_k_sum</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_lrt_time_avg_k_sum</span> <span class="o">+=</span> <span class="n">avg_log_lrt</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="n">lrt</span> <span class="o">=</span> <span class="n">log_lrt_time_avg_k_sum</span> <span class="o">*</span> <span class="n">kOneByFftSizeBy2Plus1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>LRTè¡¡é‡çš„æ˜¯ï¼Œå½“å‰è§‚å¯Ÿåˆ°çš„é¢‘è°±ï¼Œæ›´åƒæ˜¯è¯­éŸ³ä¿¡å·ï¼Œè¿˜æ˜¯æ›´åƒå™ªå£°ï¼Œæ˜¯åœ¨ä¸¤ç§å‡è®¾ä¹‹é—´è¿›è¡Œæ¯”è¾ƒï¼š</p>
<ul>
<li>$H_0$: å½“å‰å¸§æ˜¯çº¯å™ªå£°å¸§</li>
<li>$H_1$: å½“å‰å¸§æ˜¯è¯­éŸ³ + å™ªå£°å¸§</li>
</ul>
<p>é€šè¿‡è®¡ç®—ï¼š</p>
<p>$$
\Lambda = \log \left( \frac{P(X | H_1)}{P(X | H_0)} \right)
$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$P(X|H_1)$ï¼šç»™å®šä¸ºè¯­éŸ³çš„æ¡ä»¶ä¸‹ï¼Œè§‚æµ‹å€¼ X å‡ºç°çš„æ¦‚ç‡ï¼›</li>
<li>$P(X|H_0)$ï¼šç»™å®šä¸ºå™ªå£°çš„æ¡ä»¶ä¸‹ï¼Œè§‚æµ‹å€¼ X å‡ºç°çš„æ¦‚ç‡ï¼›</li>
</ul>
<p>æœ€ç»ˆè¿‘ä¼¼ç®€åŒ–ä¸ºï¼ˆæ¨å¯¼è¿‡ç¨‹è·³è¿‡äº†ï¼Œæ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œæ²¡çœ‹å¤ªæ‡‚ğŸ™ˆï¼‰ï¼š</p>
<p>$$
\text{LRT}(k) \approx  \frac{(1 + \gamma_k) \cdot 2 \cdot \xi_k}{1 + 2 \cdot \xi_k} - \log(1 + 2 \cdot \xi_k)
$$</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>$\xi_k$ï¼šé¢‘ç‚¹ k çš„å…ˆéªŒ SNRï¼›</li>
<li>$\gamma_k$ï¼šé¢‘ç‚¹ k çš„åéªŒ SNRï¼›</li>
<li>LRT è¶Šå¤§ï¼Œè¡¨æ˜ä¿¡å·æ›´åƒè¯­éŸ³ï¼›</li>
<li>LRT è¶Šå°ï¼Œè¯´æ˜æ›´åƒå™ªå£°ã€‚</li>
</ul>
<p>å†é€šè¿‡tanhå‡½æ•°æ˜ å°„åˆ°[0, 1]çš„åŒºé—´ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="c1">// Width parameter in sigmoid map for prior model.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kWidthPrior0</span> <span class="o">=</span> <span class="mf">4.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Width for pause region: lower range, so increase width in tanh map.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kWidthPrior1</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">kWidthPrior0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Average LRT feature: use larger width in tanh map for pause regions.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">width_prior</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">lrt</span> <span class="o">&lt;</span> <span class="n">prior_model</span><span class="p">.</span><span class="n">lrt</span> <span class="o">?</span> <span class="nl">kWidthPrior1</span> <span class="p">:</span> <span class="n">kWidthPrior0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Compute indicator function: sigmoid map.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">indicator0</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="mf">0.5f</span> <span class="o">*</span> <span class="p">(</span><span class="nf">tanh</span><span class="p">(</span><span class="n">width_prior</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">lrt</span> <span class="o">-</span> <span class="n">prior_model</span><span class="p">.</span><span class="n">lrt</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1.f</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="indicator1-spectral-flatness-è°±å¹³å¦åº¦">indicator1: Spectral Flatness è°±å¹³å¦åº¦</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="c1">// Updates the spectral flatness based on the input spectrum.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">UpdateSpectralFlatness</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">signal_spectrum</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">signal_spectral_sum</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span><span class="o">*</span> <span class="n">spectral_flatness</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">RTC_DCHECK</span><span class="p">(</span><span class="n">spectral_flatness</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Compute log of ratio of the geometric to arithmetic mean (handle the log(0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// separately).
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kAveraging</span> <span class="o">=</span> <span class="mf">0.3f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">avg_spect_flatness_num</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="n">spectral_flatness</span> <span class="o">-=</span> <span class="n">kAveraging</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">spectral_flatness</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg_spect_flatness_num</span> <span class="o">+=</span> <span class="nf">LogApproximation</span><span class="p">(</span><span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">avg_spect_flatness_denom</span> <span class="o">=</span> <span class="n">signal_spectral_sum</span> <span class="o">-</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">avg_spect_flatness_denom</span> <span class="o">=</span> <span class="n">avg_spect_flatness_denom</span> <span class="o">*</span> <span class="n">kOneByFftSizeBy2Plus1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">avg_spect_flatness_num</span> <span class="o">=</span> <span class="n">avg_spect_flatness_num</span> <span class="o">*</span> <span class="n">kOneByFftSizeBy2Plus1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">spectral_tmp</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ExpApproximation</span><span class="p">(</span><span class="n">avg_spect_flatness_num</span><span class="p">)</span> <span class="o">/</span> <span class="n">avg_spect_flatness_denom</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Time-avg update of spectral flatness feature.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">*</span><span class="n">spectral_flatness</span> <span class="o">+=</span> <span class="n">kAveraging</span> <span class="o">*</span> <span class="p">(</span><span class="n">spectral_tmp</span> <span class="o">-</span> <span class="o">*</span><span class="n">spectral_flatness</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>
<p>è°±å¹³å¦åº¦çš„å®šä¹‰
$$
\text{SFM} = \frac{\left( \prod_{i=1}^{N} X_i \right)^{1/N}}{\frac{1}{N} \sum_{i=1}^{N} X_i}
= \frac{\text{å‡ ä½•å‡å€¼}}{\text{ç®—æœ¯å‡å€¼}}
$$</p>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè°±å¹³å¦åº¦å¯ä»¥åŒºåˆ†è¯­éŸ³å’Œå™ªå£°
é¦–å…ˆä»çº¯æ•°å­¦è§’åº¦ï¼Œæ ¹æ®å‡å€¼ä¸ç­‰å¼æœ‰ï¼šå‡ ä½•å‡å€¼ &lt;= ç®—æ•°å‡å€¼</p>
</li>
</ul>
<ol>
<li>å½“æ‰€æœ‰å…ƒç´ ç›¸ç­‰æ—¶ï¼Œä¸¤è€…ç›¸ç­‰</li>
<li>å½“å…ƒç´ å·®å¼‚è¶Šå¤§æ—¶ï¼Œå‡ ä½•å‡å€¼ç›¸å¯¹ç®—æ•°å‡å€¼è¶Šå°ï¼Œè¯´æ˜â€œè¶Šä¸å¹³å¦â€</li>
</ol>
<p>å†å¯¹åº”åˆ°è¯­éŸ³é™å™ªåº”ç”¨ï¼š</p>
<ol>
<li>å™ªå£°ï¼ˆå°¤å…¶æ˜¯ç™½å™ªå£°ï¼‰ï¼šé¢‘å¸¦èƒ½é‡å‡åŒ€ï¼Œå‡ ä½•å‡å€¼ â‰ˆ ç®—æ•°å‡å€¼ï¼ŒFlatness â‰ˆ 1</li>
<li>è¯­éŸ³ä¿¡å·ï¼šå­˜åœ¨èƒ½é‡é›†ä¸­ï¼ˆå…±æŒ¯å³°ï¼‰ï¼Œå‡ ä½•å‡å€¼ â‰ª ç®—æ•°å‡å€¼ï¼ŒFlatness æ¥è¿‘ 0</li>
</ol>
<blockquote>
<p>å› æ­¤è°±å¹³å¦åº¦ = èƒ½é‡åˆ†å¸ƒçš„â€œå‡åŒ€æ€§é‡å°ºâ€ â†’ èƒ½ç›´æ¥ç”¨æ¥åšè¯­éŸ³/å™ªå£°åˆ†ç±»ç‰¹å¾ï¼</p>
</blockquote>
<ul>
<li>ä»£ç å®ç°</li>
</ul>
<ol>
<li>è®¡ç®—å‡ ä½•å‡å€¼</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">avg_spect_flatness_num</span> <span class="o">+=</span> <span class="nf">LogApproximation</span><span class="p">(</span><span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">avg_spect_flatness_num</span> <span class="o">=</span> <span class="n">avg_spect_flatness_num</span> <span class="o">*</span> <span class="n">kOneByFftSizeBy2Plus1</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>ç­‰ä»·äºä¸‹é¢çš„å¼å­ï¼Œå…ˆç®—logç‰ˆæœ¬</p>
<p>$$
\exp\left( \frac{1}{N} \sum \log(X_i) \right)
$$</p>
<p>å†åšæŒ‡æ•°è¿ç®—è¿˜åŸä¸ºå‡ ä½•å‡å€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="nf">ExpApproximation</span><span class="p">(</span><span class="n">avg_spect_flatness_num</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ol start="2">
<li>è®¡ç®—ç®—æ•°å‡å€¼ï¼ˆå»æ‰DCåˆ†é‡ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">avg_spect_flatness_denom</span> <span class="o">=</span> <span class="n">signal_spectral_sum</span> <span class="o">-</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">avg_spect_flatness_denom</span> <span class="o">=</span> <span class="n">avg_spect_flatness_denom</span> <span class="o">*</span> <span class="n">kOneByFftSizeBy2Plus1</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ol start="3">
<li>å¾—åˆ°è°±å¹³å¦åº¦</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">spectral_tmp</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ExpApproximation</span><span class="p">(</span><span class="n">avg_spect_flatness_num</span><span class="p">)</span> <span class="o">/</span> <span class="n">avg_spect_flatness_denom</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ol start="4">
<li>å¹³æ»‘æ›´æ–°</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="c1">// Time-avg update of spectral flatness feature.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">*</span><span class="n">spectral_flatness</span> <span class="o">+=</span> <span class="n">kAveraging</span> <span class="o">*</span> <span class="p">(</span><span class="n">spectral_tmp</span> <span class="o">-</span> <span class="o">*</span><span class="n">spectral_flatness</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="indicator2-spectral-difference-è°±æ¨¡æ¿å·®å¼‚">indicator2: Spectral Difference è°±æ¨¡æ¿å·®å¼‚</h2>
<p>Spectral Differenceé¢‘è°±å·®å¼‚æ˜¯ç”¨äºè¡¡é‡å½“å‰å¸§çš„é¢‘è°±ä¸å·²å­¦ä¹ å™ªå£°æ¨¡æ¿ä¹‹é—´çš„å·®å¼‚ç¨‹åº¦ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<blockquote>
<p>å¦‚æœå½“å‰å¸§çš„é¢‘è°±ç»“æ„ä¸å™ªå£°æ¨¡æ¿ç›¸ä¼¼ï¼Œåˆ™å¯èƒ½æ˜¯å™ªå£°ï¼›å¦‚æœå·®å¼‚å¤§ï¼Œåˆ™å¯èƒ½æ˜¯è¯­éŸ³ã€‚</p>
</blockquote>
<ol>
<li>æ€»ä½“è®¡ç®—å…¬å¼
$$
\text{SpectralDiff} = \text{Var}(X) - \frac{[\text{Cov}(X, Y)]^2}{\text{Var}(Y)}
$$</li>
</ol>
<p>å…¶ä¸­ï¼š
â€¢	Xï¼šå½“å‰å¸§çš„ ä¿¡å·é¢‘è°±ï¼›
â€¢	Yï¼šå†å²å¹³å‡çš„ å™ªå£°é¢‘è°±ï¼ˆç§°ä¸º conservative noise spectrumï¼‰ï¼›
â€¢	$\mathrm{Var}$ï¼šæ–¹å·®ï¼ˆæè¿°â€œèµ·ä¼ç¨‹åº¦â€ï¼‰ï¼›
â€¢	$\mathrm{Cov}$ï¼šåæ–¹å·®ï¼ˆæè¿°â€œæ˜¯å¦è”åŠ¨â€ï¼‰ã€‚</p>
<ol start="2">
<li>ä¸ºä»€ä¹ˆå®ƒèƒ½è¡¡é‡ç›¸ä¼¼ç¨‹åºï¼Ÿ</li>
</ol>
<p>ä»ç»Ÿè®¡è§’åº¦çœ‹ï¼ŒVar(X) - Cov(X, Y)^2 / Var(Y) æ˜¯å½“å‰å¸§ä¸­ ä¸è¿‡å»æ¨¡æ¿ä¸ä¸€è‡´çš„èƒ½é‡ã€‚å¦‚æœï¼š</p>
<ul>
<li>å¦‚æœ signal â‰ˆ noiseï¼ˆå™ªå£°å¸§ï¼‰ï¼šâ†’ covarianceÂ² / noise_variance â‰ˆ signal_variance â†’ spectral_diff â‰ˆ 0</li>
<li>å¦‚æœ signal åŒ…å«è¯­éŸ³æˆåˆ†ï¼ˆç»“æ„å’Œå™ªå£°ä¸ä¸€æ ·ï¼‰ï¼šâ†’ covariance å°ï¼Œspectral_diff å¢å¤§</li>
</ul>
<p>è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šç­‰ä»·äºï¼š</p>
<p>Var(Residual) = Var(Signal) - Var(ProjectedNoiseComponent)</p>
<p>å³ï¼šå½“å‰å¸§ä¸­é™¤äº†å¯ä»¥ç”¨å™ªå£°è§£é‡Šçš„éƒ¨åˆ†ï¼Œå‰©ä¸‹æœ‰å¤šå°‘â€œå¼‚å¸¸èƒ½é‡â€</p>
<h2 id="å¤šç‰¹å¾èåˆ">å¤šç‰¹å¾èåˆ</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="c1">// Combine the indicator function with the feature weights.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">ind_prior</span> <span class="o">=</span> <span class="n">prior_model</span><span class="p">.</span><span class="n">lrt_weighting</span> <span class="o">*</span> <span class="n">indicator0</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                    <span class="n">prior_model</span><span class="p">.</span><span class="n">flatness_weighting</span> <span class="o">*</span> <span class="n">indicator1</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                    <span class="n">prior_model</span><span class="p">.</span><span class="n">difference_weighting</span> <span class="o">*</span> <span class="n">indicator2</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>æœ€ç»ˆç»„åˆè¿™ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p>
<ul>
<li>æ¯ä¸ªç‰¹å¾éƒ½æœ‰ç‹¬ç«‹çš„æƒé‡</li>
<li>äº’è¡¥æ€§å¼ºï¼Œæå‡ç¨³å¥æ€§</li>
</ul>
<p>ä¸¾ä¾‹å­ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æƒ…å†µ</th>
          <th>LRT</th>
          <th>Flatness</th>
          <th>Spectral Diff</th>
          <th>åˆ¤æ–­ç»“æœ</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>çŸ­ä¿ƒè¾…éŸ³ [k]</td>
          <td>é«˜</td>
          <td>é«˜ï¼ˆåƒå™ªå£°ï¼‰</td>
          <td>ä½ï¼ˆåƒæ¨¡æ¿ï¼‰</td>
          <td>ä¸èƒ½ä»…é  flatness åˆ¤æ–­ï¼Œindicator2 å¼¥è¡¥</td>
      </tr>
      <tr>
          <td>èƒŒæ™¯çªå‘å™ªå£°</td>
          <td>é«˜</td>
          <td>é«˜</td>
          <td>é«˜</td>
          <td>indicator2 æŠ‘åˆ¶è¯¯åˆ¤</td>
      </tr>
      <tr>
          <td>è¯­éŸ³æš‚åœæœŸ</td>
          <td>ä½</td>
          <td>é«˜</td>
          <td>é«˜</td>
          <td>ä¸‰é¡¹å‡ä¸ºä½ï¼ŒVAD é™éŸ³</td>
      </tr>
  </tbody>
</table>
<h2 id="è®¡ç®—é¢‘ç‚¹çš„åéªŒè¯­éŸ³æ¦‚ç‡">è®¡ç®—é¢‘ç‚¹çš„åéªŒè¯­éŸ³æ¦‚ç‡</h2>
<ul>
<li>å¹³æ»‘æ›´æ–°å…ˆéªŒè¯­éŸ³æ¦‚ç‡</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="c1">// Compute the prior probability.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">prior_speech_prob_</span> <span class="o">+=</span> <span class="mf">0.1f</span> <span class="o">*</span> <span class="p">(</span><span class="n">ind_prior</span> <span class="o">-</span> <span class="n">prior_speech_prob_</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Make sure probabilities are within range: keep floor to 0.01.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">prior_speech_prob_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="nf">max</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="nf">min</span><span class="p">(</span><span class="n">prior_speech_prob_</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">),</span> <span class="mf">0.01f</span><span class="p">);</span></span></span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>è®¡ç®—åéªŒè¯­éŸ³æ¦‚ç‡
å› ä¸ºprior_speech_prob_æ˜¯é€šè¿‡å†å²ä¿¡æ¯ä¼°è®¡çš„å½“å‰å¸§è¯­éŸ³æ¦‚ç‡ï¼Œå› æ­¤è¿™ä¸ªæ¦‚ç‡ç§°ä¸ºå…ˆéªŒè¯­éŸ³æ¦‚ç‡ã€‚å®é™…ä½¿ç”¨æ—¶æˆ‘ä»¬ä¸éœ€è¦æˆ‘ä»¬è§‚å¯Ÿåˆ°å½“å¸§åç»™å‡ºçš„æ¦‚ç‡ï¼Œå³åéªŒè¯­éŸ³æ¦‚ç‡ã€‚</li>
</ul>
<p>è´å¶æ–¯å®šç†ç»™å‡ºåéªŒæ¦‚ç‡å…¬å¼ï¼š</p>
<p>$$
P(H_1 \mid X) = \frac{P(H_1) \cdot P(X \mid H_1)}{P(H_1) \cdot P(X \mid H_1) + P(H_0) \cdot P(X \mid H_0)}
$$</p>
<p>æˆ‘ä»¬å¼•å…¥ï¼š
â€¢	$\text{Prior} = P(H_1)$
â€¢	$\text{Gain} = \frac{1 - \text{Prior}}{\text{Prior}}$
â€¢	$\text{LRT} = \frac{P(X \mid H_1)}{P(X \mid H_0)}$</p>
<p>å¯å¾—åéªŒè¯­éŸ³æ¦‚ç‡ï¼ˆç®€åŒ–æ¨å¯¼ï¼‰ï¼š</p>
<p>$$
P(H_1 \mid X) = \frac{1}{1 + \text{Gain} \cdot \frac{1}{\text{LRT}}}
$$</p>
<p>è¿™æ­£æ˜¯ä»£ç ä¸­è¿™æ®µçš„å®ç°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl">  <span class="c1">// Final speech probability: combine prior model with LR factor:.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">float</span> <span class="n">gain_prior</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="mf">1.f</span> <span class="o">-</span> <span class="n">prior_speech_prob_</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">prior_speech_prob_</span> <span class="o">+</span> <span class="mf">0.0001f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">inv_lrt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">ExpApproximationSignFlip</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">avg_log_lrt</span><span class="p">,</span> <span class="n">inv_lrt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">speech_probability_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.f</span> <span class="o">+</span> <span class="n">gain_prior</span> <span class="o">*</span> <span class="n">inv_lrt</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>å…¶ä¸­ï¼š
â€¢	gain_prior = (1 - prior_speech_prob_) / (prior_speech_prob_ + Îµ)
â€¢	inv_lrt[i] = e^{-avg_log_lrt[i]} â‰ˆ 1 / LRT ï¼ˆæŒ‡æ•°è¿‘ä¼¼ï¼‰</p>
<h2 id="åˆ©ç”¨è¯­éŸ³æ¦‚ç‡è¾…åŠ©æ›´æ–°å™ªå£°è°±">åˆ©ç”¨è¯­éŸ³æ¦‚ç‡è¾…åŠ©æ›´æ–°å™ªå£°è°±</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">NoiseEstimator</span><span class="o">::</span><span class="nf">PostUpdate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="o">&gt;</span> <span class="n">speech_probability</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtc</span><span class="o">::</span><span class="n">ArrayView</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">float</span><span class="p">,</span> <span class="n">kFftSizeBy2Plus1</span><span class="o">&gt;</span> <span class="n">signal_spectrum</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Time-avg parameter for noise_spectrum update.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kNoiseUpdate</span> <span class="o">=</span> <span class="mf">0.9f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">float</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">kNoiseUpdate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kFftSizeBy2Plus1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">float</span> <span class="n">prob_speech</span> <span class="o">=</span> <span class="n">speech_probability</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">float</span> <span class="n">prob_non_speech</span> <span class="o">=</span> <span class="mf">1.f</span> <span class="o">-</span> <span class="n">prob_speech</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Temporary noise update used for speech frames if update value is less
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// than previous.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">noise_update_tmp</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="n">gamma</span> <span class="o">*</span> <span class="n">prev_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="mf">1.f</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prob_non_speech</span> <span class="o">*</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                         <span class="n">prob_speech</span> <span class="o">*</span> <span class="n">prev_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Time-constant based on speech/noise_spectrum state.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">gamma_old</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Increase gamma for frame likely to be seech.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">constexpr</span> <span class="kt">float</span> <span class="n">kProbRange</span> <span class="o">=</span> <span class="mf">.2f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">gamma</span> <span class="o">=</span> <span class="n">prob_speech</span> <span class="o">&gt;</span> <span class="n">kProbRange</span> <span class="o">?</span> <span class="mf">.99f</span> <span class="o">:</span> <span class="n">kNoiseUpdate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Conservative noise_spectrum update.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">prob_speech</span> <span class="o">&lt;</span> <span class="n">kProbRange</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">conservative_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span>
</span></span><span class="line"><span class="cl">          <span class="mf">0.05f</span> <span class="o">*</span> <span class="p">(</span><span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">conservative_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Noise_spectrum update.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">==</span> <span class="n">gamma_old</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">noise_update_tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">          <span class="n">gamma</span> <span class="o">*</span> <span class="n">prev_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="mf">1.f</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">prob_non_speech</span> <span class="o">*</span> <span class="n">signal_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                           <span class="n">prob_speech</span> <span class="o">*</span> <span class="n">prev_noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Allow for noise_spectrum update downwards: If noise_spectrum update
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// decreases the noise_spectrum, it is safe, so allow it to happen.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="nf">min</span><span class="p">(</span><span class="n">noise_spectrum_</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">noise_update_tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯webrtcä¸­ç»“åˆè¯­éŸ³æ¦‚ç‡ï¼Œå¯¹ä¹‹å‰åŸºäºåˆ†ä½æ•°ä¼°è®¡å¾—åˆ°çš„å™ªå£°è°±ï¼Œè¿›è¡Œè¿›ä¸€æ­¥ä¿®æ­£çš„è¿‡ç¨‹ã€‚</p>
<p>é‚£ä¸ºä»€ä¹ˆå·²ç»æœ‰äº†åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡ï¼Œè¿˜éœ€è¦åœ¨PostUpdate()ä¸­è¿›è¡Œè¿›ä¸€æ­¥ä¿®æ­£å‘¢ï¼Ÿ</p>
<p>å¦‚ä¸‹è¡¨ï¼Œæˆ‘ä»¬å¯¹æ¯”ä¸åˆå§‹åˆ†ä½æ•°ä¼°è®¡çš„å…³ç³»å’ŒåŒºåˆ«</p>
<table>
  <thead>
      <tr>
          <th>ç‰¹å¾</th>
          <th>PreUpdate() ä¸­çš„åˆ†ä½æ•°ä¼°è®¡</th>
          <th>PostUpdate() ä¸­çš„æ—¶é—´å¹³å‡æ›´æ–°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>åŸç†</td>
          <td>ç»Ÿè®¡è¿‡å¾€å¸§çš„åº•å™ªåˆ†å¸ƒï¼ˆlog-domainï¼‰</td>
          <td>åˆ©ç”¨å½“å‰å¸§çš„è¯­éŸ³æ¦‚ç‡è¿›è¡Œæ—¶é—´é€’å½’æ›´æ–°</td>
      </tr>
      <tr>
          <td>æ›´æ–°ç»´åº¦</td>
          <td>æ¨ªå‘ï¼ˆè·¨å¸§åˆ†å¸ƒï¼‰</td>
          <td>çºµå‘ï¼ˆå¸§å†…æ—¶é—´å¹³æ»‘ï¼‰</td>
      </tr>
      <tr>
          <td>å“åº”ç‰¹æ€§</td>
          <td>å¯¹èƒŒæ™¯ç¼“æ…¢å˜åŒ–æœ‰å“åº”ï¼Œå¯¹çªå‘è¯­éŸ³ç¨³å¥</td>
          <td>åœ¨è¯­éŸ³å¸§æœŸé—´æŠ‘åˆ¶æ›´æ–°ï¼Œéè¯­éŸ³å¸§ä¸­è½»å¾®ä¿®æ­£</td>
      </tr>
      <tr>
          <td>å¯¹åº”å˜é‡</td>
          <td>quantile_noise_estimator_.Estimate(&hellip;) â†’ noise_spectrum_[]</td>
          <td>åˆå€¼	noise_spectrum_[] â†’ å¹³æ»‘åŠ¨æ€è¿½è¸ªä¿®æ­£</td>
      </tr>
      <tr>
          <td>ç›®çš„</td>
          <td>å»ºç«‹åˆæ­¥å™ªå£°æ¨¡å‹</td>
          <td>ç»†åŒ–å¹¶åŠ¨æ€è¿½è¸ªå™ªå£°è°±</td>
      </tr>
  </tbody>
</table>
<h3 id="æ€»ç»“ä¸ºä»€ä¹ˆéœ€è¦-postupdate">æ€»ç»“ï¼šä¸ºä»€ä¹ˆéœ€è¦ PostUpdateï¼Ÿ</h3>
<ul>
<li>åˆ†ä½æ•°ä¼°è®¡ï¼ˆPreUpdateï¼‰å¾ˆå¼ºå¥ï¼Œä½†æ…¢ã€‚</li>
<li>PostUpdate æä¾› å¿«é€Ÿã€å¹³æ»‘ã€æ¦‚ç‡é©±åŠ¨ çš„åŠ¨æ€è°ƒæ•´æœºåˆ¶ã€‚</li>
<li>é˜²æ­¢è¯­éŸ³èƒ½é‡æ±¡æŸ“å™ªå£°ä¼°è®¡ï¼›</li>
<li>ä¿æŒå™ªå£°è°±èƒ½æŒç»­è·Ÿè¸ª éå¹³ç¨³å™ªå£°ï¼ˆå¦‚ç©ºè°ƒå¼€å…³ã€é£å£°å˜åŒ–ï¼‰ï¼›</li>
<li>ä¸ºåç»­ Wiener æ»¤æ³¢å™¨æä¾›æ›´å¯é çš„å™ªå£°è°±è¾“å…¥ã€‚</li>
</ul>
<p>Ok! åˆ°è¿™é‡ŒWebRTCå°±çœŸæ­£å®Œæˆäº†å™ªå£°è°±çš„ä¼°è®¡ï¼Œæ¥ä¸‹ç»§ç»­åˆ†äº«WebRTCè¯­éŸ³é™å™ªä»£ç .</p>
<h4 id="to-be-continue">To Be Continue!!!</h4>
]]></content:encoded>
    </item>
    <item>
      <title>WebRTCè¯­éŸ³é™å™ªä¹‹åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡</title>
      <link>https://lyapple2008.github.io/posts/202506/2025-06-28-%E5%9F%BA%E4%BA%8E%E5%88%86%E4%BD%8D%E6%95%B0%E7%9A%84%E5%99%AA%E5%A3%B0%E4%BC%B0%E8%AE%A1/</link>
      <pubDate>Sat, 28 Jun 2025 15:38:44 +0800</pubDate>
      <guid>https://lyapple2008.github.io/posts/202506/2025-06-28-%E5%9F%BA%E4%BA%8E%E5%88%86%E4%BD%8D%E6%95%B0%E7%9A%84%E5%99%AA%E5%A3%B0%E4%BC%B0%E8%AE%A1/</guid>
      <description>&lt;h2 id=&#34;å™ªå£°ä¼°è®¡çš„ä½œç”¨&#34;&gt;å™ªå£°ä¼°è®¡çš„ä½œç”¨&lt;/h2&gt;
&lt;p&gt;å™ªå£°ä¼°è®¡ç®—æ³•åœ¨æ•´ä¸ªè¯­éŸ³é™å™ªç³»ç»Ÿä¸­èµ·åˆ°æ ¸å¿ƒæ”¯æ’‘ä½œç”¨ï¼Œå…ˆéªŒSNRå’ŒåéªŒSNRçš„è®¡ç®—éƒ½ä¾èµ–äºå½“å‰å¸§çš„å™ªå£°åŠŸç‡è°±ä¼°è®¡ã€‚è‹¥å™ªå£°ä¼°è®¡åä½ï¼Œä¼šå¯¼è‡´ä¿ç•™å¤ªå¤šå™ªå£°ï¼ˆè¿‡åº¦ä¿ç•™ï¼‰ï¼›è‹¥å™ªå£°ä¼°è®¡åé«˜ï¼Œä¼šæŠŠè¯­éŸ³å½“ä½œå™ªå£°è¿‡æ»¤æ‰ï¼ˆè¯­éŸ³å¤±çœŸï¼‰ï¼› æ›´æ–°ä¸ç¨³å®šï¼Œæ•´ä½“å¬æ„Ÿæ—¶å¥½æ—¶åï¼Œå¿½å¤§å¿½å°ï¼Œå‡ºç°â€æ³µå£°â€œã€â€éŸ³ä¹å™ªå£°â€œç°è±¡ã€‚æœ¬æ–‡ä»‹ç»WebRTCä¸­ç›®å‰ä½¿ç”¨çš„åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡ç®—æ³•ï¼ŒåŠå…¶åœ¨å·¥ç¨‹å®ç°ä¸­çš„å·§å¦™ä¹‹å¤„ã€‚&lt;/p&gt;</description>
      <content:encoded><![CDATA[<h2 id="å™ªå£°ä¼°è®¡çš„ä½œç”¨">å™ªå£°ä¼°è®¡çš„ä½œç”¨</h2>
<p>å™ªå£°ä¼°è®¡ç®—æ³•åœ¨æ•´ä¸ªè¯­éŸ³é™å™ªç³»ç»Ÿä¸­èµ·åˆ°æ ¸å¿ƒæ”¯æ’‘ä½œç”¨ï¼Œå…ˆéªŒSNRå’ŒåéªŒSNRçš„è®¡ç®—éƒ½ä¾èµ–äºå½“å‰å¸§çš„å™ªå£°åŠŸç‡è°±ä¼°è®¡ã€‚è‹¥å™ªå£°ä¼°è®¡åä½ï¼Œä¼šå¯¼è‡´ä¿ç•™å¤ªå¤šå™ªå£°ï¼ˆè¿‡åº¦ä¿ç•™ï¼‰ï¼›è‹¥å™ªå£°ä¼°è®¡åé«˜ï¼Œä¼šæŠŠè¯­éŸ³å½“ä½œå™ªå£°è¿‡æ»¤æ‰ï¼ˆè¯­éŸ³å¤±çœŸï¼‰ï¼› æ›´æ–°ä¸ç¨³å®šï¼Œæ•´ä½“å¬æ„Ÿæ—¶å¥½æ—¶åï¼Œå¿½å¤§å¿½å°ï¼Œå‡ºç°â€æ³µå£°â€œã€â€éŸ³ä¹å™ªå£°â€œç°è±¡ã€‚æœ¬æ–‡ä»‹ç»WebRTCä¸­ç›®å‰ä½¿ç”¨çš„åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡ç®—æ³•ï¼ŒåŠå…¶åœ¨å·¥ç¨‹å®ç°ä¸­çš„å·§å¦™ä¹‹å¤„ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡">ä»€ä¹ˆæ˜¯åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡</h2>
<p>åŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡ç®—æ³•æ˜¯ä¸€ç§åˆ©ç”¨ä¿¡å·ç»Ÿè®¡ç‰¹æ€§åŒºåˆ†å™ªå£°å’Œè¯­éŸ³çš„è‡ªé€‚åº”æ–¹æ³•ã€‚å…¶æ ¸å¿ƒåŸç†åœ¨äºï¼šå™ªå£°çš„èƒ½é‡åˆ†å¸ƒé€šå¸¸é›†ä¸­åœ¨ä½åˆ†ä½åŒºåŸŸï¼Œè€Œè¯­éŸ³ä¿¡å·çš„èƒ½é‡åˆ†å¸ƒä¼šæŠ¬é«˜é«˜åˆ†ä½æ•°ã€‚</p>
<h2 id="webrtcä¸­çš„å®ç°è§£è¯»å¦™å‘€">WebRTCä¸­çš„å®ç°è§£è¯»ï¼ˆå¦™å‘€ï¼‰</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># ä»£ç ä½ç½®
</span></span><span class="line"><span class="cl">modules/audio_processing/ns/quantile_noise_estimator.h 
</span></span><span class="line"><span class="cl">modules/audio_processing/ns/quantile_noise_estimator.cc</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="åˆ†ä½æ•°è®¡ç®—">åˆ†ä½æ•°è®¡ç®—</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">log_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.25f</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">0.75f</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>ä»¥ä¸Šæ˜¯WebRTCä¸­åˆ†ä½æ•°è®¡ç®—çš„ä»£ç ï¼Œå®ƒè¡¨ç¤º25%åˆ†ä½æ•°ä¼°è®¡ï¼Œä¸‹é¢æˆ‘ä»¬æ¥é€æ­¥è¯´æ˜ä¸ºä»€ä¹ˆè¿™æ®µä»£ç å¯ä»¥è®¡ç®—25%åˆ†ä½æ•°ã€‚</p>
<h4 id="ä»€ä¹ˆæ˜¯åˆ†ä½æ•°">ä»€ä¹ˆæ˜¯åˆ†ä½æ•°ï¼Ÿ</h4>
<p>ä»¥25%åˆ†ä½æ•°ä¸ºä¾‹ï¼Œå®ƒè¡¨ç¤ºï¼šå¦‚æœä½ è§‚å¯Ÿä¸€ç»„æ•°ï¼Œæœ‰25%æ˜¯å°äºå®ƒçš„ï¼Œæœ‰75%æ˜¯å¤§äºå®ƒçš„ã€‚
æ¯”å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æ•°æ®ï¼ˆå·²æ’åºï¼‰ï¼š[1, 2, 3, 4, 5, 6, 7, 8, 9]
</span></span><span class="line"><span class="cl">0.25åˆ†ä½æ•° â‰ˆ ç¬¬3ä¸ªæ•° = 3</span></span></code></pre></td></tr></table>
</div>
</div>
<h4 id="éå¯¹ç§°æ›´æ–°çš„æ•°å­¦ç›´è§‰">éå¯¹ç§°æ›´æ–°çš„æ•°å­¦ç›´è§‰</h4>
<p>è®¾ï¼šå½“å‰ä¼°è®¡å€¼ä¸ºQï¼Œå½“å‰è§‚æµ‹å€¼ä¸ºX</p>
<p>æˆ‘ä»¬æ¯å¸§æ›´æ–°è§„åˆ™å¦‚ä¸‹ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æƒ…å†µ</th>
          <th>æ›´æ–°é‡</th>
          <th>å«ä¹‰</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>x &gt; Q</td>
          <td>Q â† Q + 0.25 Ã— step</td>
          <td>å½“å‰å€¼å¤ªå¤§ï¼Œç¨å¾®æ‹‰é«˜ä¼°è®¡å€¼</td>
      </tr>
      <tr>
          <td>x &lt; Q</td>
          <td>Q â† Q - 0.75 Ã— step</td>
          <td>å½“å‰å€¼å¤ªå°ï¼Œå¤§å¹…æ‹‰ä½ä¼°è®¡å€¼</td>
      </tr>
  </tbody>
</table>
<h4 id="æ”¶æ•›åˆ†æå¹³è¡¡ç‚¹--25åˆ†ä½æ•°">æ”¶æ•›åˆ†æï¼šå¹³è¡¡ç‚¹ = 25%åˆ†ä½æ•°</h4>
<p>è€ƒè™‘è¿ç»­è§‚å¯Ÿå¤§é‡å€¼ {xâ‚, xâ‚‚, &hellip;, xâ‚™}ï¼Œä¼°è®¡å€¼ Q å¦‚æœåœ¨ä¸€ä¸ªå›ºå®šä½ç½®é™„è¿‘æ³¢åŠ¨ï¼Œé‚£å®ƒä¸€å®šæ»¡è¶³ï¼š
å¹³å‡ä¸Šè°ƒé‡ â‰ˆ å¹³å‡ä¸‹è°ƒé‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é‚£ä¸ªç‚¹ï¼š</p>
<blockquote>
<p>ä¸Šè°ƒæ¦‚ç‡ Ã— ä¸Šè°ƒæ­¥é•¿ = ä¸‹è°ƒæ¦‚ç‡ Ã— ä¸‹è°ƒæ­¥é•¿</p>
</blockquote>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>ä¸Šè°ƒæ¦‚ç‡ p_up = P(x &gt; Q)</li>
<li>ä¸‹è°ƒæ¦‚ç‡ p_down = P(x &lt; Q) = 1 - p_up</li>
<li>ä¸Šè°ƒæ­¥é•¿ = 0.25</li>
<li>ä¸‹è°ƒæ­¥é•¿ = 0.75
è®¡ç®—å¯ä»¥å¾—åˆ°ï¼šp_down = 0.25</li>
</ul>
<p>âœ… è¯´æ˜è¿™ä¸ªä¼°è®¡æœ€ç»ˆä¼šé€¼è¿‘ 25% åˆ†ä½æ•°ï¼</p>
<blockquote>
<p>è¿™ä¸ªåˆ†ä½æ•°çš„å®ç°çœŸæ˜¯å¦™äº†å‘€ï¼Œé¿å…äº†å¸¸è§„åˆ†ä½è®¡ç®—éœ€è¦æ’åºçš„é—®é¢˜ï¼ŒåŒæ—¶è¿˜å¯ä»¥å®æ—¶æ›´æ–°ã€‚ğŸ‘</p>
</blockquote>
<h3 id="å¤šåˆ†ä½æ•°ä¼°è®¡åˆ†æ—¶æ›´æ–°">å¤šåˆ†ä½æ•°ä¼°è®¡åˆ†æ—¶æ›´æ–°</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="o">//</span> <span class="n">Loop</span> <span class="n">over</span> <span class="n">simultaneous</span> <span class="n">estimates</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="ne">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">kSimult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="o">++</span><span class="n">s</span><span class="p">,</span> <span class="n">k</span> <span class="o">+=</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="ne">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kFftSizeBy2Plus1</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="ne">float</span> <span class="n">one_by_counter_plus_1</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span><span class="n">f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="ne">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">static_cast</span><span class="o">&lt;</span><span class="ne">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kFftSizeBy2Plus1</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="n">Update</span> <span class="nb">log</span> <span class="n">quantile</span> <span class="n">estimate</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="ne">float</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="n">f</span> <span class="err">?</span> <span class="mf">40.</span><span class="n">f</span> <span class="o">/</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">:</span> <span class="mf">40.</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="ne">float</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">one_by_counter_plus_1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">log_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.25</span><span class="n">f</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">0.75</span><span class="n">f</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="o">//</span> <span class="n">Update</span> <span class="n">density</span> <span class="n">estimate</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">      <span class="n">constexpr</span> <span class="ne">float</span> <span class="n">kWidth</span> <span class="o">=</span> <span class="mf">0.01</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">constexpr</span> <span class="ne">float</span> <span class="n">kOneByWidthPlus2</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="n">f</span> <span class="o">*</span> <span class="n">kWidth</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">log_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">kWidth</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">kOneByWidthPlus2</span><span class="p">)</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">                      <span class="n">one_by_counter_plus_1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">kLongStartupPhaseBlocks</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">num_updates_</span> <span class="o">&gt;=</span> <span class="n">kLongStartupPhaseBlocks</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">quantile_index_to_return</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">++</span><span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>kLongStartupPhaseBlocks=200ï¼Œæ„å‘³ç€åˆ†ä½æ•°ä¼°è®¡åœ¨200å¸§åï¼Œå³2ç§’ï¼Œæ‰ä¼šæ›´æ–°é‡ç½®è¾“å‡ºä¼°è®¡ç»“æœã€‚webrtcä¸ºäº†å‡å°‘å“åº”å»¶è¿Ÿï¼Œè®¾ç½®äº†ä¸‰ä¸ªé”™ä½çš„ç‹¬ç«‹åˆ†ä½æ•°ä¼°è®¡å™¨ï¼Œå¦‚ä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªåˆ†ä½æ•°ä¼°è®¡å™¨çš„æ›´æ–°è®¡æ•°æ˜¯é”™å¼€çš„ï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°æ¯67å¸§ï¼Œå³670msï¼Œå°±ä¼šæœ‰ä¸€ä¸ªåˆ†ä½æ•°ä¼°è®¡å™¨è¿›è¡Œé‡ç½®æ›´æ–°è¾“å‡ºä¼°è®¡ç»“æœï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿå“åº”çš„æ•ˆæœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="n">constexpr</span> <span class="ne">float</span> <span class="n">kOneBySimult</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">f</span> <span class="o">/</span> <span class="n">kSimult</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kSimult</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">counter_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="n">kLongStartupPhaseBlocks</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1.</span><span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">kOneBySimult</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="åˆ©ç”¨å¯†åº¦ä¼°è®¡å®ç°è‡ªé€‚åº”æ­¥é•¿">åˆ©ç”¨â€å¯†åº¦â€œä¼°è®¡å®ç°è‡ªé€‚åº”æ­¥é•¿</h3>
<p>åˆ†ä½æ•°ä¼°è®¡å™¨åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œå…¶æ›´æ–°æ­¥é•¿ä¸è¿™ä¸ªdensity_å˜é‡ç›´æ¥ç›¸å…³ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸‹webrtcçš„å®ç°æ˜¯å¦‚ä½•åšåˆ°è‡ªé€‚åº”æ­¥é•¿çš„ã€‚</p>
<blockquote>
<p>density_[j]è¡¨ç¤º: å½“å‰åˆ†ä½æ•°ä¼°è®¡ç‚¹é™„è¿‘çš„â€å±€éƒ¨å¯†åº¦ä¼°è®¡â€œï¼Œè¿‘ä¼¼è¡¨ç¤ºè¿™ä¸ªlogé¢‘è°±ç‚¹çš„æ¦‚ç‡å¯†åº¦å‡½æ•°å€¼ã€‚</p>
</blockquote>
<p>ç°å®åœºæ™¯ä¸­ï¼Œå™ªå£°é¢‘ç‚¹èƒ½é‡åˆ†å¸ƒæ˜¯å˜åŒ–çš„ï¼Œå½“ä½å™ªå£°å˜åŒ–æ—¶ï¼Œå™ªå£°é¢‘ç‚¹èƒ½é‡åˆ†å¸ƒå¯†é›†ï¼›å½“è¯­éŸ³å˜åŒ–æ—¶ï¼Œå™ªå£°é¢‘ç‚¹èƒ½é‡åˆ†å¸ƒç¨€ç–ã€‚å› æ­¤éœ€è¦ä¼°è®¡åˆ†å¸ƒå¯†åº¦ï¼Œä»¥è°ƒæ•´æ­¥é•¿åŠ¨æ€æ€§ï¼Œé˜²æ­¢åœ¨é«˜å¯†åº¦æˆ–ä½å¯†åº¦åŒºåŸŸè¿‡åº¦æŠ–åŠ¨æˆ–è€…å¤ªæ…¢ååº”</p>
<ul>
<li>density_æ˜¯å¦‚ä½•è®¡ç®—çš„</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">Update</span> <span class="n">density</span> <span class="n">estimate</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">constexpr</span> <span class="ne">float</span> <span class="n">kWidth</span> <span class="o">=</span> <span class="mf">0.01</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">constexpr</span> <span class="ne">float</span> <span class="n">kOneByWidthPlus2</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="n">f</span> <span class="o">*</span> <span class="n">kWidth</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">log_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">log_quantile_</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">kWidth</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">counter_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">kOneByWidthPlus2</span><span class="p">)</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">                <span class="n">one_by_counter_plus_1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>è¿™æ˜¯ä¸€ç§æ»‘åŠ¨çª—å£ç»Ÿè®¡ä¼°è®¡æ³•ï¼š</p>
<table>
  <thead>
      <tr>
          <th>æ­¥éª¤</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>fabs(&hellip;) &lt; kWidth</td>
          <td>å½“å‰è§‚æµ‹å€¼æ˜¯å¦è½åœ¨ä¼°è®¡å€¼ Â±0.01 èŒƒå›´å†…</td>
      </tr>
      <tr>
          <td>kOneByWidthPlus2 = 1 / (2 Ã— 0.01)</td>
          <td>è¿™æ˜¯ä¸€ä¸ªå¸¸æ•°æƒé‡ï¼ˆç»éªŒå€¼ï¼‰</td>
      </tr>
      <tr>
          <td>density_[j] = (&hellip;)</td>
          <td>ä½¿ç”¨ æŒ‡æ•°æ»‘åŠ¨å¹³å‡ æ¥æ›´æ–°å¯†åº¦å€¼</td>
      </tr>
      <tr>
          <td>æœ€ç»ˆçš„æ•ˆæœæ˜¯ï¼š</td>
          <td></td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>density_[j] è¶‹è¿‘äºâ€œå•ä½å®½åº¦çª—å£â€å†…å‘½ä¸­æ¬¡æ•°çš„å¹³å‡å€¼ â€”â€” è¡¨ç¤ºåœ¨åˆ†ä½ç‚¹é™„è¿‘çš„ä¿¡å·é¢‘è°±å¯†é›†ç¨‹åº¦ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">const</span> <span class="ne">float</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="n">f</span> <span class="err">?</span> <span class="mf">40.</span><span class="n">f</span> <span class="o">/</span> <span class="n">density_</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">:</span> <span class="mf">40.</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="ne">float</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">one_by_counter_plus_1</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>density_å˜é‡ç›´æ¥å½±å“äº†åˆ†ä½æ•°ä¼°è®¡çš„æ­¥é•¿ï¼Œä¹Ÿå°±æ˜¯è¯´</p>
<ul>
<li>å¦‚æœ density_ é«˜ï¼šè¯´æ˜è¿™ä¸ªé¢‘ç‡ç‚¹çš„èƒ½é‡æ¯”è¾ƒâ€œç¨³å®šâ€ï¼Œå˜åŒ–è¾ƒå° â†’ delta ä¼šå° â†’ æ›´æ–°å˜æ…¢</li>
<li>å¦‚æœ density_ ä½ï¼šè¯´æ˜è¿™ä¸ªç‚¹çš„èƒ½é‡æ³¢åŠ¨å¤§ â†’ delta ä¼šå¤§ â†’ æ›´æ–°æ›´æ¿€è¿›</li>
</ul>
<p>æ€»ç»“å°±æ˜¯ï¼Œdensity_ è¡¨ç¤ºå½“å‰åˆ†ä½ç‚¹é™„è¿‘çš„å±€éƒ¨é¢‘è°±å¯†åº¦ï¼Œç”¨äºè°ƒèŠ‚æ›´æ–°é€Ÿç‡ï¼Œå¸®åŠ© WebRTC å®ç°ç¨³å®šã€é²æ£’ã€å¿«é€Ÿæ”¶æ•›çš„åº•å™ªä¼°è®¡ã€‚</p>
<p>Okï¼Œè¿™å°±æ˜¯WebRTCä¸­åŸºäºåˆ†ä½æ•°å™ªå£°ä¼°è®¡çš„å…¨éƒ¨äº†ã€‚æ€»çš„æ¥è¯´ï¼ŒåŸºäºåˆ†ä½æ•°çš„å™ªå£°ä¼°è®¡ç®—æ³•åŸç†ç®€å•ï¼Œä½†WebRTCçš„å®ç°æœ‰å¾ˆå¤šå·§å¦™çš„åœ°æ–¹ï¼Œå³ä¿è¯äº†æ•ˆæœï¼Œä¹Ÿæé«˜äº†æ•ˆç‡ï¼Œç»å¯¹æ˜¯å·¥ç¨‹ç²¾åå€¼å¾—å¥½å¥½ç ”ç©¶ã€‚</p>
<p>æ¥ä¸‹æ¥ä¼šç»§ç»­åˆ†äº«WebRTCè¯­éŸ³é™å™ªéƒ¨åˆ†ä»£ç ï¼Œå¸Œæœ›å¯¹æœ‰å…´è¶£çš„æœ‹å‹æœ‰å¸®åŠ©ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>QMFåˆ†æç»¼åˆæ»¤æ³¢å™¨</title>
      <link>https://lyapple2008.github.io/posts/202202/2022-02-03-qmf%E5%88%86%E6%9E%90%E7%BB%BC%E5%90%88%E6%BB%A4%E6%B3%A2%E5%99%A8/</link>
      <pubDate>Thu, 03 Feb 2022 11:35:16 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/202202/2022-02-03-qmf%E5%88%86%E6%9E%90%E7%BB%BC%E5%90%88%E6%BB%A4%E6%B3%A2%E5%99%A8/</guid>
      <description>&lt;h1 id=&#34;åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„çš„ä½œç”¨&#34;&gt;åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„çš„ä½œç”¨&lt;/h1&gt;
&lt;p&gt;ç”±äºéŸ³é¢‘ä¿¡å·åœ¨ä¸åŒçš„é¢‘ç‡èŒƒå›´å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œå› æ­¤åœ¨éŸ³é¢‘å¤„ç†ä¹‹å‰é€šå¸¸éƒ½ä¼šä½¿ç”¨åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„å°†éŸ³é¢‘ä¿¡å·åˆ†æˆä¸åŒçš„é¢‘ç‡å­å¸¦ï¼Œå†åˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚ï¼ŒéŸ³é¢‘ç¼–ç ä¸­å¸¸ç”¨åˆ°çš„å­å¸¦ç¼–ç ï¼ˆSubband codingï¼‰ï¼›webrtcçš„VADä¸­ï¼Œä¼šå¯¹ä¸åŒçš„é¢‘ç‡å­å¸¦è®¡ç®—ç‰¹å¾ï¼Œå†ç»¼åˆè¿™äº›ç‰¹å¾è®¡ç®—è¯­éŸ³æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;!-- {% asset_img 001.png %} --&gt;
&lt;img src=&#34;https://lyapple2008.github.io/images/2022-02-03-001.png&#34;/&gt;</description>
      <content:encoded><![CDATA[<h1 id="åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„çš„ä½œç”¨">åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„çš„ä½œç”¨</h1>
<p>ç”±äºéŸ³é¢‘ä¿¡å·åœ¨ä¸åŒçš„é¢‘ç‡èŒƒå›´å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œå› æ­¤åœ¨éŸ³é¢‘å¤„ç†ä¹‹å‰é€šå¸¸éƒ½ä¼šä½¿ç”¨åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„å°†éŸ³é¢‘ä¿¡å·åˆ†æˆä¸åŒçš„é¢‘ç‡å­å¸¦ï¼Œå†åˆ†åˆ«è¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚ï¼ŒéŸ³é¢‘ç¼–ç ä¸­å¸¸ç”¨åˆ°çš„å­å¸¦ç¼–ç ï¼ˆSubband codingï¼‰ï¼›webrtcçš„VADä¸­ï¼Œä¼šå¯¹ä¸åŒçš„é¢‘ç‡å­å¸¦è®¡ç®—ç‰¹å¾ï¼Œå†ç»¼åˆè¿™äº›ç‰¹å¾è®¡ç®—è¯­éŸ³æ¦‚ç‡ã€‚</p>
<!-- {% asset_img 001.png %} -->
<img src="/images/2022-02-03-001.png"/>
<h1 id="åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„æ˜¯å¦‚ä½•å®ç°">åˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„æ˜¯å¦‚ä½•å®ç°</h1>
<p>åœ¨WebRTCä¸­ä½¿ç”¨æœ€å¤šçš„æ˜¯åŸºäºIIRå®ç°çš„äºŒé€šé“QMFåˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„ï¼Œé€šè¿‡äºŒé€šé“QMFæ»¤æ³¢å™¨ç»„ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿å®ç°Nç­‰åˆ†çš„å­å¸¦åˆ†è§£ï¼Œå› æ­¤è¿™é‡Œåªä»‹ç»äºŒé€šé“QMFæ»¤æ³¢å™¨ç»„ã€‚</p>
<!-- {% asset_img 002.png %} -->
<img src="/images/2022-02-03-002.png"/>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œåˆ†æç»¼åˆæ»¤æ³¢å™¨åŒ…å«åˆ†æéƒ¨åˆ†å’Œç»¼åˆéƒ¨åˆ†ï¼Œå½“ä¸­é—´æ²¡æœ‰ä»»ä½•å¤„ç†æ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿçš„è¾“å…¥è¾“å‡ºå…³ç³»å¦‚ä¸‹ï¼š</p>
<!-- {% asset_img 008.png %} -->
<img src="/images/2022-02-03-008.png"/>
<!-- {% asset_img 003.png %} -->
<img src="/images/2022-02-03-003.png"/>
<p>å¯ä»¥çœ‹åˆ°åˆ†ææ»¤æ³¢å™¨éƒ¨åˆ†çš„é«˜é€šå’Œä½é€šéƒ¨åˆ†çš„é¢‘ç‡å“åº”ç½‘çº¿æ­£å¥½æ˜¯ç›¸å¯¹pi/2é•œåƒå¯¹ç§°çš„ï¼ŒQMFå«é•œåƒæ»¤æ³¢å™¨çš„ç”±æ¥ã€‚å›¾ä¸­Xa0ä»£è¡¨çš„å°±æ˜¯è¾“å…¥ä¿¡å·çš„ä½é¢‘éƒ¨åˆ†ï¼Œè€ŒXa1ä»£è¡¨çš„å°±æ˜¯è¾“å…¥ä¿¡å·çš„é«˜é¢‘éƒ¨åˆ†ï¼Œè¿™æ ·é€šè¿‡åˆ†ææ»¤æ³¢å™¨åï¼Œå°±å¯ä»¥å¯¹ä¿¡å·çš„ä½é¢‘éƒ¨åˆ†å’Œé«˜é¢‘éƒ¨åˆ†è¿›è¡Œåˆ†åˆ«å¤„ç†äº†ã€‚</p>
<!-- {% asset_img 004.png %} -->
<img src="/images/2022-02-03-004.png"/>
å› æ­¤åªè¦æŒ‰ä¸‹é¢çš„ç­‰å¼è¿›è¡Œæ»¤æ³¢å™¨è®¾è®¡ï¼Œå°±å¯ä»¥è®©A(z)=0ï¼Œå³æ¶ˆé™¤æ··å ï¼Œå®ç°å®Œå–„é‡æ„ã€‚
<!-- {% asset_img 005.png %} -->
<img src="/images/2022-02-03-005.png"/>
<p>ä¸ºäº†æ•ˆç‡ï¼Œé€šå¸¸ä¼šé‡‡ç”¨å¤šç›¸å½¢å¼å®ç°QMFç»„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¿¡å·å¤„ç†å‰éƒ½ä¼šè¿›è¡ŒæŠ½å–æ“ä½œï¼Œè¿™äº›å®é™…å¤„ç†çš„æ•°æ®é‡å°±å‡å°‘äº†ï¼Œä»è€Œæå‡äº†æ‰§è¡Œæ•ˆç‡</p>
<!-- {% asset_img 006.png %} -->
<img src="/images/2022-02-03-006.png"/>
<p>åœ¨QMFç»„çš„å¤šç›¸å½¢å¼ä¸­å¯¹åº”çš„ä½é€šæ»¤æ³¢å™¨å’Œé«˜é€šæ»¤æ³¢å™¨å¦‚ä¸Šå¼æ‰€ç¤ºã€‚
WebRTCä¸­çš„å®ç°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">void</span> <span class="n">WebRtcSpl_AnalysisQMF</span><span class="p">(</span><span class="k">const</span> <span class="n">int16_t</span><span class="o">*</span> <span class="n">in_data</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">in_data_length</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">int16_t</span><span class="o">*</span> <span class="n">low_band</span><span class="p">,</span> <span class="n">int16_t</span><span class="o">*</span> <span class="n">high_band</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">int32_t</span><span class="o">*</span> <span class="n">filter_state1</span><span class="p">,</span> <span class="n">int32_t</span><span class="o">*</span> <span class="n">filter_state2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int16_t</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">half_in1</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">half_in2</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">filter1</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32_t</span> <span class="n">filter2</span><span class="p">[</span><span class="n">kMaxBandFrameLength</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">size_t</span> <span class="n">band_length</span> <span class="o">=</span> <span class="n">in_data_length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">RTC_DCHECK_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">in_data_length</span> <span class="o">%</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">RTC_DCHECK_LE</span><span class="p">(</span><span class="n">band_length</span><span class="p">,</span> <span class="n">kMaxBandFrameLength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">Split</span> <span class="n">even</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">samples</span><span class="o">.</span> <span class="n">Also</span> <span class="n">shift</span> <span class="n">them</span> <span class="n">to</span> <span class="n">Q10</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">band_length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">k</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">half_in2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">int32_t</span><span class="p">)</span><span class="n">in_data</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">half_in1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">int32_t</span><span class="p">)</span><span class="n">in_data</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">All</span> <span class="k">pass</span> <span class="n">filter</span> <span class="n">even</span> <span class="ow">and</span> <span class="n">odd</span> <span class="n">samples</span><span class="p">,</span> <span class="n">independently</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebRtcSpl_AllPassQMF</span><span class="p">(</span><span class="n">half_in1</span><span class="p">,</span> <span class="n">band_length</span><span class="p">,</span> <span class="n">filter1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">WebRtcSpl_kAllPassFilter1</span><span class="p">,</span> <span class="n">filter_state1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebRtcSpl_AllPassQMF</span><span class="p">(</span><span class="n">half_in2</span><span class="p">,</span> <span class="n">band_length</span><span class="p">,</span> <span class="n">filter2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">WebRtcSpl_kAllPassFilter2</span><span class="p">,</span> <span class="n">filter_state2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">Take</span> <span class="n">the</span> <span class="n">sum</span> <span class="ow">and</span> <span class="n">difference</span> <span class="n">of</span> <span class="n">filtered</span> <span class="n">version</span> <span class="n">of</span> <span class="n">odd</span> <span class="ow">and</span> <span class="n">even</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">branches</span> <span class="n">to</span> <span class="n">get</span> <span class="n">upper</span> <span class="o">&amp;</span> <span class="n">lower</span> <span class="n">band</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">band_length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">filter2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">low_band</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">WebRtcSpl_SatW32ToW16</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">filter2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1024</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">high_band</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">WebRtcSpl_SatW32ToW16</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<p>ä¸Šé¢æ˜¯WebRTCä¸­å…³äºåˆ†ææ»¤æ³¢å™¨éƒ¨åˆ†çš„å®ç°ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºWebRTCä¸­çš„åˆ†æç»¼åˆæ»¤æ³¢å™¨æ˜¯åŸºäºå…¨é€šæ»¤æ³¢å™¨çš„QMFå¤šç›¸å®ç°ï¼Œå…¶ä¸­çš„å…¨é€šæ»¤å™¨é‡‡ç”¨äº†IIRå®ç°ï¼Œå³å…¶ä¸­çš„P0(z)å’ŒP1(z)éƒ½æ˜¯å…¨é€šæ»¤æ³¢å™¨ã€‚é€šè¿‡å‚è€ƒ[2]æˆ‘ä»¬å¯ä»¥æ¢³ç†è¿™ä¸ªé—®é¢˜çš„å¤„ç†æµç¨‹ï¼Œé€šè¿‡åˆ†æQMFåˆ†æç»¼åˆæ»¤æ³¢å™¨æ»¡è¶³å®Œç¾é‡æ„çš„æ¡ä»¶ï¼Œå¯ä»¥å¾—åˆ°H0ã€H1ã€G0ã€G1ä¹‹é—´çš„å…³ç³»ï¼ŒåŒæ—¶H0å’ŒH1æ˜¯åŸºäºpi/2ï¼Œå› æ­¤åªéœ€è¦çŸ¥é“H0ï¼Œæœ€ç»ˆè½¬åŒ–æˆH0ä½é€šæ»¤æ³¢å™¨çš„è®¾è®¡é—®é¢˜ã€‚è¿›ä¸€æ­¥çš„ç”±äºé‡‡ç”¨äº†åŸºäºIIRçš„å…¨é€šæ»¤æ³¢å™¨ï¼Œå› æ­¤åªéœ€è¦è€ƒè™‘ç›¸ä½å¤±çœŸé—®é¢˜ï¼Œæœ€ç»ˆQMFåˆ†æç»¼åˆæ»¤æ³¢å™¨é—®é¢˜è½¬æ¢æˆäº†æ»¤æ³¢å™¨çš„ç›¸ä½å‡è¡¡é—®é¢˜ã€‚è™½ç„¶æˆ‘ä»¬çŸ¥é“äº†è®¾è®¡QMFåˆ†æç»¼åˆæ»¤æ³¢å™¨çš„åŸç†å’Œæ€è·¯ï¼Œä½†æ˜¯æƒ³è®¾è®¡ä¸€ä¸ªå®Œå…¨å¯ç”¨çš„æ»¤æ³¢å™¨è¿˜æ˜¯å¾ˆæœ‰éš¾åº¦çš„ï¼Œä¸‹é¢æˆ‘ä»¬ç›´æ¥çœ‹ä¸‹WebRTCä¸­QMFåˆ†æç»¼åˆæ»¤æ³¢å™¨çš„æ•ˆæœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ä½é€šæ»¤æ³¢å™¨å’Œé«˜é€šæ»¤æ³¢å™¨éƒ½æœ‰å¾ˆçª„çš„è¿‡æ¸¡å¸¦ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¹…å€¼å“åº”å‡ ä¹æ¥è¿‘0dBçš„ï¼ŒåŒæ—¶é™¤äº†pi/2é™„è¿‘çš„é¢‘å¸¦éƒ½æ˜¯è¿‘ä¼¼çº¿æ€§ç›¸ä½çš„ã€‚</p>
<!-- {% asset_img 007.png %} -->
<img src="/images/2022-02-03-007.png"/>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">scipy</span><span class="o">.</span><span class="k">signal</span> <span class="n">as</span> <span class="k">signal</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">numpy</span> <span class="n">as</span> <span class="n">np</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span> <span class="n">as</span> <span class="n">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">control</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">analysis_synthesis_filter</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter1_coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6418.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">36982.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">57261.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">filter2_coef</span> <span class="o">=</span> <span class="p">[</span><span class="mf">21333.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">49062.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">,</span> <span class="mf">63010.0</span> <span class="o">/</span> <span class="mf">65536.0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_0_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_0_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_1_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_1_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_2_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter1_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_2_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter1_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha1_0_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_0_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_1_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_1_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_2_b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">filter2_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_2_a</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter2_coef</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha0_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_2_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_1_b</span><span class="p">,</span> <span class="n">ha0_0_b</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha0_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_2_a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha0_1_a</span><span class="p">,</span> <span class="n">ha0_0_a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_2_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_1_b</span><span class="p">,</span> <span class="n">ha1_0_b</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_2_a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">ha1_1_a</span><span class="p">,</span> <span class="n">ha1_0_a</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ha0_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">ha0_b</span><span class="p">,</span> <span class="n">ha0_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ha1_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">ha1_b</span><span class="p">,</span> <span class="n">ha1_a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">b0_sys</span> <span class="o">=</span> <span class="n">ha1_sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">b1_sys</span> <span class="o">=</span> <span class="n">ha0_sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">delay_sys</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_sys</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">+</span> <span class="n">ha1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_sys</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">-</span> <span class="n">ha1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_sys</span> <span class="o">=</span> <span class="n">delay_sys</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ha0_sys</span> <span class="o">*</span> <span class="n">b0_sys</span> <span class="o">+</span> <span class="n">ha1_sys</span> <span class="o">*</span> <span class="n">b1_sys</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># print(t_sys)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_num</span> <span class="o">=</span> <span class="n">lowpass_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_den</span> <span class="o">=</span> <span class="n">lowpass_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_num</span> <span class="o">=</span> <span class="n">highpass_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_den</span> <span class="o">=</span> <span class="n">highpass_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_num</span> <span class="o">=</span> <span class="n">t_sys</span><span class="o">.</span><span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_den</span> <span class="o">=</span> <span class="n">t_sys</span><span class="o">.</span><span class="n">den</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">lowpass_w</span><span class="p">,</span> <span class="n">lowpass_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">lowpass_num</span><span class="p">,</span> <span class="n">lowpass_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">highpass_w</span><span class="p">,</span> <span class="n">highpass_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">highpass_num</span><span class="p">,</span> <span class="n">highpass_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_w</span><span class="p">,</span> <span class="n">t_h</span> <span class="o">=</span> <span class="k">signal</span><span class="o">.</span><span class="n">freqz</span><span class="p">(</span><span class="n">t_num</span><span class="p">,</span> <span class="n">t_den</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lowpass_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lowpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">lowpass_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">highpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">highpass_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">highpass_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">highpass_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_h</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_w</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">t_h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="n">True</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></span></span></code></pre></td></tr></table>
</div>
</div>
<h1 id="æœ€è¿‘çš„ä¸€äº›å¿ƒå¾—">æœ€è¿‘çš„ä¸€äº›å¿ƒå¾—</h1>
<p>æœ€åè¯´ä¸‹è¿‘æœŸçš„ä¸¤ç‚¹å°å¿ƒå¾—ï¼š</p>
<ol>
<li>ä¸æ‡‚çš„çŸ¥è¯†ç‚¹è¯·å°½æ—©å¼„æ‡‚å®ƒã€‚å…¶å®å¯¹äºQMFåˆ†æç»¼åˆæ»¤æ³¢å™¨ç»„ï¼Œåœ¨æœ€å¼€å§‹å­¦ä¹ éŸ³é¢‘ç¼–ç æ—¶å°±é‡åˆ°äº†ï¼Œä½†æ˜¯å½“æ—¶æ²¡æœ‰æ·±å…¥çš„å»ææ¸…æ¥šï¼Œæœ€åè¿˜æ˜¯æ²¡æœ‰èº²è¿‡å»ã€‚æ‰€ä»¥æœ€è¿‘ä¹Ÿæ˜¯æ¶è¡¥äº†å¾ˆå¤šåŸºç¡€çŸ¥è¯†ï¼Œæ‰å¤§è‡´äº†è§£äº†QMFçš„è®¾è®¡æ€è·¯ã€‚</li>
<li>ä¸æ–­åœ°è¾“å‡ºä¹Ÿè®¸æ˜¯åº”å¯¹ç„¦è™‘çš„ä¸€ç§æ–¹æ³•ã€‚äººåˆ°ä¸­å¹´éš¾å…ç„¦è™‘ï¼Œå°±ä¸åœåœ°å»å­¦ä¹ å»å¸æ”¶ï¼Œä½†æ˜¯å¾€å¾€åˆæ˜¯å¾ˆä½æ•ˆçš„ï¼Œæ—¶é—´èŠ±äº†ï¼Œå´ä»€ä¹ˆä¹Ÿæ²¡æœ‰ç•™ä¸‹ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è¿™ä¸ªä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œå„ç§ä¿¡æ¯æµï¼Œç¢ç‰‡åŒ–é˜…è¯»ï¼Œè®©æˆ‘ä»¬çœ‹èµ·æ¥æ”¶è·äº†å¾ˆå¤šï¼Œå…¶å®ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚å…¶å®æˆ‘ä»¬è¦å¯¹è‡ªå·±æ˜¯å‡ å¹³ç±³çš„æˆ¿å­æœ‰åŸºæœ¬çš„è®¤çŸ¥ï¼Œå°æˆ¿å­å°±åº”è¯¥æ”¾å°‘çš„ã€å°çš„ä¸œè¥¿ï¼Œå®šæœŸå¯¹æˆ¿é—´è¿›è¡Œæ•´ç†ï¼Œæ°¸è¿œä¿æŒä¸€å®šçš„ç©ºé—´çš„ç•™ç™½ï¼Œæ‰ä¼šæœ‰å–˜æ¯å’Œç¾çš„ä½™åœ°ã€‚</li>
</ol>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<ol>
<li>Book:ã€Šæ•°å­—ä¿¡å·å¤„ç†ï¼šç†è®ºã€ç®—æ³•ä¸åº”ç”¨ã€‹</li>
<li>Paper: å…·æœ‰è‰¯å¥½é‡å»ºç‰¹æ€§çš„æ­£äº¤é•œåƒIIRæ»¤æ³¢å™¨ç»„çš„è®¾è®¡æ–°æ–¹æ³•</li>
<li>Paper: IIR QMF-bank design for speech and audio subband coding</li>
<li>Blog: WebRTC VAD ä¸­æ‰€ç”¨æ»¤æ³¢å™¨ä¹‹åˆ†æ_book_bbyuançš„åšå®¢-CSDNåšå®¢</li>
</ol>]]></content:encoded>
    </item>
    <item>
      <title>WebRTCä¸­çš„éŸ³é¢‘å¤„ç†æ¦‚è§ˆ</title>
      <link>https://lyapple2008.github.io/posts/202112/2021-12-22-webrtc%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E5%A4%84%E7%90%86%E6%A6%82%E8%A7%88/</link>
      <pubDate>Sat, 22 Jan 2022 10:53:15 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/202112/2021-12-22-webrtc%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E5%A4%84%E7%90%86%E6%A6%82%E8%A7%88/</guid>
      <description>&lt;!-- {% asset_img 001.png %} --&gt;
&lt;img src=&#34;https://lyapple2008.github.io/images/2021-12-22-001.png&#34;/&gt;
&lt;p&gt;WebRTCç”±éŸ³é¢‘å¼•æ“ã€è§†é¢‘å¼•æ“å’Œä¼ è¾“æ¨¡å—ï¼ŒéŸ³é¢‘å¤„ç†åœ¨WebRTCå äº†å¾ˆå¤§ä¸€å—ï¼Œæœ¬æ–‡ä¸»è¦å¯¹WebRTCä¸­æ¶‰åŠçš„éŸ³é¢‘å¤„ç†è¿›è¡Œç®€å•ä»‹ç»ï¼Œä¸ä¼šå¯¹å…·ä½“çš„å®ç°è¿›è¡Œä»‹ç»ã€‚ä¸Šå›¾æ˜¯WebRTCä¸­éŸ³é¢‘å¤„ç†çš„æµæ°´çº¿ï¼ˆä¸Šé¢çš„å›¾æ˜¯ç½‘ä¸Šçš„å›¾ï¼Œå¦‚æœ‰ä¾µæƒï¼Œé€šçŸ¥å³åˆ ï¼‰ï¼Œå¯ä»¥çœ‹å‡ºä¸»è¦åŒ…å«äº†éŸ³é¢‘é‡‡é›†æ’­æ”¾ã€éŸ³é¢‘å¤„ç†ã€éŸ³é¢‘ç¼–è§£ç å’ŒéŸ³é¢‘ä¼ è¾“ã€‚ä¸‹é¢å¯¹è¿™äº›æ¨¡å—é€ä¸€è¿›è¡Œä»‹ç»ã€‚&lt;/p&gt;</description>
      <content:encoded><![CDATA[<!-- {% asset_img 001.png %} -->
<img src="/images/2021-12-22-001.png"/>
<p>WebRTCç”±éŸ³é¢‘å¼•æ“ã€è§†é¢‘å¼•æ“å’Œä¼ è¾“æ¨¡å—ï¼ŒéŸ³é¢‘å¤„ç†åœ¨WebRTCå äº†å¾ˆå¤§ä¸€å—ï¼Œæœ¬æ–‡ä¸»è¦å¯¹WebRTCä¸­æ¶‰åŠçš„éŸ³é¢‘å¤„ç†è¿›è¡Œç®€å•ä»‹ç»ï¼Œä¸ä¼šå¯¹å…·ä½“çš„å®ç°è¿›è¡Œä»‹ç»ã€‚ä¸Šå›¾æ˜¯WebRTCä¸­éŸ³é¢‘å¤„ç†çš„æµæ°´çº¿ï¼ˆä¸Šé¢çš„å›¾æ˜¯ç½‘ä¸Šçš„å›¾ï¼Œå¦‚æœ‰ä¾µæƒï¼Œé€šçŸ¥å³åˆ ï¼‰ï¼Œå¯ä»¥çœ‹å‡ºä¸»è¦åŒ…å«äº†éŸ³é¢‘é‡‡é›†æ’­æ”¾ã€éŸ³é¢‘å¤„ç†ã€éŸ³é¢‘ç¼–è§£ç å’ŒéŸ³é¢‘ä¼ è¾“ã€‚ä¸‹é¢å¯¹è¿™äº›æ¨¡å—é€ä¸€è¿›è¡Œä»‹ç»ã€‚</p>
<h1 id="éŸ³é¢‘é‡‡é›†æ’­æ”¾">éŸ³é¢‘é‡‡é›†æ’­æ”¾</h1>
<p>è‡ªç„¶ç•Œçš„å£°éŸ³ï¼ŒåŒ…æ‹¬äººè¯´å‡ºæ¥çš„å£°éŸ³ï¼Œéƒ½æ˜¯æ¨¡æ‹Ÿä¿¡å·ï¼Œè¿™äº›æ¨¡æ‹Ÿä¿¡å·æ˜¯ä¸èƒ½è¢«è®¡ç®—æœºå­˜å‚¨å’Œè¯†åˆ«çš„ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ è¾“ã€‚éŸ³é¢‘é‡‡é›†å°±æ˜¯å£°éŸ³ä»æ¨¡æ‹Ÿä¿¡å·è½¬æ¢æˆæ•°å­—ä¿¡å·çš„è¿‡ç¨‹ï¼Œè€ŒéŸ³é¢‘æ’­æ”¾å°±æ˜¯å£°éŸ³ä»æ•°å­—ä¿¡å·è½¬æ¢æˆæ¨¡æ‹Ÿä¿¡å·çš„è¿‡ç¨‹ã€‚å¯¹äºéŸ³é¢‘æ•°å­—ä¿¡å·æ¥è¯´æœ‰ä»¥ä¸‹å‡ ä¸ªæœ€ä¸»è¦çš„å‚æ•°ï¼š</p>
<ol>
<li>é‡‡æ ·ç‡
é‡‡æ ·ç‡æ˜¯æŒ‡å½•éŸ³è®¾å¤‡åœ¨ä¸€ç§’é’Ÿå†…å¯¹å£°éŸ³ä¿¡å·çš„é‡‡æ ·æ¬¡æ•°ï¼Œå•ä½æ˜¯Hzï¼Œé‡‡æ ·é¢‘ç‡è¶Šé«˜ï¼Œå£°éŸ³çš„è¿˜åŸåº¦è¶ŠçœŸå®è¶Šè‡ªç„¶ã€‚ä½†æ˜¯äººè€³å¯ä»¥å¬åˆ°çš„é¢‘åº¦èŒƒå›´æ˜¯20Hz~20000Hzï¼Œç„¶åæ ¹æ®é‡‡æ ·å®šç†ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ä½åªéœ€è¦40kHzé‡‡æ ·ç‡å°±å¯ä»¥æ»¡è¶³äººè€³çš„éœ€æ±‚äº†ï¼Œå› æ­¤CDéŸ³è´¨å’ŒéŸ³ä¹éŸ³é¢‘éƒ½æ˜¯44.1kHzã€‚ä½†æ˜¯é‡‡æ ·ç‡è¶Šé«˜æ„å‘³ç€æ•°æ®é‡è¶Šå¤§ï¼Œå› æ­¤åœ¨ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ä¼šä½¿ç”¨æ›´ä½çš„é‡‡æ ·ç‡ï¼Œå¦‚è¯­éŸ³é€šè¯åœºæ™¯ï¼Œå› ä¸ºäººå£°éƒ½æ˜¯ä½äº4kHzï¼Œå› æ­¤åœ¨è¯­éŸ³é€šè¯åœºæ™¯æ›´å¤šä¼šä½¿ç”¨8kHzæˆ–è€…16kHzçš„é‡‡æ ·ç‡ã€‚</li>
</ol>
<!-- {% asset_img 002.png %} -->
<img src="/images/2021-12-22-002.png"/>
<ol start="2">
<li>é‡‡æ ·ä½å®½
å£°éŸ³æ¨¡æ‹Ÿä¿¡å·ç»è¿‡é‡‡æ ·åå¾—ä¸€ä¸ªä¸ªæ ·ç‚¹çš„å€¼ï¼Œè¿™ä¸ªå€¼éœ€è¦å­˜å‚¨åˆ°è®¡ç®—æœºä¸­ï¼Œé‚£ä¹ˆä½¿ç”¨å¤šå°‘ä½æ•°æ¥è¡¨ç¤ºè¿™ä¸ª å°±æ˜¯é‡‡æ ·ä½å®½ï¼Œé€šå¸¸ä½¿ç”¨æœ€å¤šçš„æ˜¯16bitï¼Œæ­£å¥½å°±æ˜¯ä¸€ä¸ªshortç±»å‹ã€‚</li>
<li>å£°é“æ•°
åœ¨ä½¿ç”¨å½•éŸ³è®¾å¤‡è¿›è¡Œå£°éŸ³é‡‡é›†æ—¶ï¼Œåªèƒ½è¡¨ç¤ºåˆ°é‡‡é›†ç‚¹å¤„çš„å£°éŸ³ä¿¡å·ï¼Œä½†æ˜¯å®é™…å£°éŸ³æ˜¯æœ‰ç©ºé—´ä¿¡æ¯ï¼Œä¸ºäº†è¡¨è¾¾å£°éŸ³çš„ç©ºé—´ä¿¡æ¯ï¼Œå°±æœ‰äº†å£°é“çš„æ¦‚å¿µã€‚è¿™é‡Œæœ€æœ‰åçš„å¯èƒ½å°±æ˜¯æœæ¯”å…¨æ™¯å£°äº†ï¼Œå¤§å®¶åœ¨ç”µå½±é™¢çœ‹ç”µå½±çš„æ—¶å€™ï¼Œæ„Ÿå—åˆ°çš„è¢«å£°éŸ³åŒ…å›´çš„çœŸå®æ„Ÿå°±æ˜¯å¤šå£°é“çš„åŠŸåŠ³äº†ï¼Œå½“ç„¶è¿™é‡Œå¹¶ä¸æ˜¯åŠ å¤šå‡ ä¸ªé€šé“è¿™ä¹ˆç®€å•å•¦ã€‚</li>
</ol>
<!-- {% asset_img 003.png %} -->
<img src="/images/2021-12-22-003.png"/>
<h1 id="éŸ³é¢‘ç¼–è§£ç ">éŸ³é¢‘ç¼–è§£ç </h1>
<p>è™½ç„¶éŸ³é¢‘çš„æ•°æ®é‡æ²¡æœ‰è§†é¢‘çš„é‡é‚£ä¹ˆå¤§ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä¼ è¾“åŸå§‹çš„éŸ³é¢‘æ•°æ®ï¼ˆåŸå§‹çš„éŸ³é¢‘æ•°æ®æœ‰ä¸ªåå­—å«Pulse Code Modulation (PCM)ï¼‰ï¼Œæ•°æ®é‡ä¹Ÿæ˜¯æŒºå¤§çš„ã€‚ç°åœ¨æˆ‘ä»¬æ¥è®¡ç®—ä¸‹1ç§’é‡‡æ ·ç‡ä¸º48kHzåŒé€šé“çš„éŸ³é¢‘ä¿¡å·çš„æ•°æ®é‡æœ‰å¤šå¤§ï¼Œ1ç§’ * 48000ä¸ªé‡‡æ ·ç‚¹ * 2ä¸ªå£°é“ * æ¯ä¸ªæ ·ç‚¹2Bytesï¼Œè¿™æ ·1ç§’çš„æ•°æ®é‡æ˜¯192kBå­—èŠ‚ã€‚è¿™æ ·çš„æ•°æ®é‡åœ¨äº’è”ç½‘å‘å±•çš„æ—©æœŸä¹Ÿæ˜¯ä¸å¯ä»¥æ¥å—çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦éŸ³é¢‘ç¼–è§£ç ã€‚ç®€å•çš„è¯´ï¼ŒéŸ³é¢‘ç¼–è§£ç å°±æ˜¯åˆ©ç”¨äººè€³çš„å¿ƒç†å£°å­¦ç‰¹æ€§å°†ä¹Ÿä¸€äº›ä¸å½±å“å¬è§‰çš„ä¿¡å·ä¸¢å¼ƒï¼Œä»è€Œå‡å°‘ä¿¡å·é‡çš„æ–¹æ³•ï¼Œåœ¨WebRTCä¸­ç”¨å¾—æœ€å¤šçš„æ˜¯Opusæ ¼å¼ã€‚å¯¹äºéŸ³é¢‘ç¼–ç å™¨æ¥è¯´ä¸€ä¸ªå¾ˆé‡è¦çš„å‚æ•°æ˜¯ç ç‡ï¼Œå•ä½æ˜¯kbpsï¼Œå³æ¯ç§’çš„éŸ³é¢‘ä½¿ç”¨å¤šå°‘bitsä½æ¥è¡¨ç¤ºã€‚éŸ³é¢‘ç¼–è§£ç æ˜¯éŸ³é¢‘é¢†åŸŸä¸€ä¸ªå¾ˆä¸“ä¸šçš„é¢†åŸŸï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<h1 id="éŸ³é¢‘å¤„ç†">éŸ³é¢‘å¤„ç†</h1>
<p>åœ¨å®æ—¶é€šè¯åœºæ™¯ï¼Œéœ€è¦é¢å¯¹å„ç§å¤æ‚çš„ç¯å¢ƒï¼Œå¤„ç†å„ç§éŸ³é¢‘é—®é¢˜ï¼Œæœ€å¸¸è§çš„å¦‚å™ªå£°ã€å›å£°ã€å£°éŸ³è¿‡å¤§è¿‡å°ç­‰ï¼ŒWebRTCä¸­æœ‰ä¸€ä¸ªä¸“é—¨çš„éŸ³é¢‘å¤„ç†æ¨¡å—æ¥å¤„ç†è¿™äº›é—®é¢˜ï¼Œä¸‹é¢å°±ç®€å•ä»‹ç»ä¸‹è¿™äº›æ¨¡å—ã€‚</p>
<ol>
<li>å›å£°æ¶ˆé™¤ï¼ˆAcoustic Echo Cancellationï¼‰
å®é™…é€šè¯åœºæ™¯æ˜¯ä¸€ä¸ªå…¨åŒå·¥é€šä¿¡ç³»ç»Ÿéå®¹æ˜“äº§ç”Ÿå›å£°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿œç«¯è¯´è¯å£°==ã€‹è¿‘ç«¯æ‰¬å£°å™¨æ’­æ”¾==ã€‹è¿‘ç«¯éº¦å…‹é£å½•åˆ¶==ã€‹é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°è¿œç«¯çš„æ‰¬å£°å™¨æ’­æ”¾ï¼Œç»è¿‡è¿™æ ·ä¸€ä¸ªéŸ³é¢‘ç¯è·¯åï¼Œè¿œç«¯åˆåœ¨æ‰¬å£°å™¨é‡Œå¬åˆ°è‡ªå·±çš„å£°éŸ³ï¼Œä¹Ÿå°±æ˜¯å›å£°ï¼Œå¦‚æœå›å£°çš„å»¶æ—¶å¾ˆä½æ—¶è¿˜ä¼šäº§ç”Ÿå•¸å«ï¼Œè¿™æ ·æ˜¯å¾ˆå½±å“é€šè¯ä½“éªŒçš„ã€‚è¿™æ—¶å°±éœ€è¦å›å£°æ¶ˆé™¤AECæ¨¡å—äº†ï¼Œé€šå¸¸å½•éŸ³æ•°æ®éƒ½ä¼šå…ˆç»è¿‡ä¸ªæ¨¡å—ï¼Œåœ¨ä¼ è¾“å‰å…ˆæŠŠè¿œç«¯æ’­æ”¾çš„æ•°æ®æ¶ˆé™¤ï¼Œè¿™æ ·è¿œç«¯åœ¨æ’­æ”¾çš„æ—¶å€™å°±ä¸ä¼šå¬åˆ°å›å£°äº†ã€‚å›å£°æ¶ˆé™¤AECè¯¦ç»†çš„åŸç†ä»‹ç»ç•™åˆ°åé¢å†ä»‹ç»ï¼Œè¿™é‡Œå…ˆæŒ–ä¸ªå‘ã€‚</li>
</ol>
<!-- {% asset_img 004.png %} -->
<img src="/images/2021-12-22-004.png"/>
<ol start="2">
<li>å™ªå£°æŠ‘åˆ¶ï¼ˆNoise Suppressionï¼‰
å™ªå£°æŠ‘åˆ¶NSè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå®é™…çš„é€šè¯åœºæ™¯éƒ½ä¼šå­˜åœ¨å„ç§å„æ ·çš„å™ªå£°ï¼Œä¸ºäº†ä¿è¯é€šè¯ä½“éªŒä¸å—å½±å“ï¼Œè¿™æ—¶å°±éœ€è¦å™ªå£°æŠ‘åˆ¶NSæ¨¡å—äº†ã€‚è¿™é‡Œä¹Ÿå†æŒ–ä¸€å‘ï¼Œåé¢å†æ ¹æ®WebRTCæºç è¿›è¡Œå™ªå£°æŠ‘åˆ¶åŸç†ä»‹ç»ã€‚</li>
<li>è‡ªåŠ¨å¢ç›Šæ§åˆ¶ï¼ˆAuto Gain Controlï¼‰
åœ¨å®é™…é€šè¯è¿‡ç¨‹ä¸­ï¼Œç”±äºä½¿ç”¨è®¾å¤‡çš„å·®å¼‚å’Œé€šè¯æ—¶ç¦»éº¦å…‹é£çš„è¿œè¿‘ï¼Œå¯¼è‡´äº†é€šè¯çš„éŸ³é‡å·®å¼‚ï¼Œä¸ºäº†è¾¾åˆ°ç»Ÿä¸€çš„ä½“éªŒå°±éœ€è¦è¿›è¡Œè‡ªåŠ¨å¢ç›Šæ§åˆ¶ï¼Œç®€å•è¯´å°±æ˜¯å½“éŸ³é‡å°æ—¶è°ƒå¤§å¢ç›Šï¼Œå½“éŸ³é‡å¤§æ—¶è°ƒå°å¢ç›Šï¼Œè¾¾åˆ°å‡å°‘éŸ³é‡èµ·ä¼çš„ä½œç”¨ã€‚</li>
<li>æ··éŸ³ï¼ˆMixï¼‰
åœ¨å¤šäººé€šè¯åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ¥æ”¶å’Œæ’­æ”¾çš„é€šå¸¸ä¸æ­¢ä¸€æ¡éŸ³é¢‘æµï¼Œä½†é€šå¸¸åªæœ‰ä¸€ä¸ªæ’­æ”¾è®¾å¤‡ï¼Œå› æ­¤é€šå¸¸éœ€è¦å¯¹å¤šæ¡éŸ³é¢‘æµå…ˆè¿›è¡Œæ··éŸ³æ“ä½œï¼Œå†è¿›è¡Œæ’­æ”¾ã€‚</li>
</ol>
<h1 id="éŸ³é¢‘ä¼ è¾“">éŸ³é¢‘ä¼ è¾“</h1>
<p>ç›®å‰WebRTCéŸ³é¢‘ä¼ è¾“æ˜¯UDP/RTP/RTCPåè®®åŸºç¡€ä¸Šè¿›è¡Œä¼ è¾“çš„ï¼Œåº•å±‚UDPåè®®çš„ä¸å¯é æ€§ï¼Œå¯¼è‡´ä¸¢åŒ…ä¸å¯é¿å…ï¼ŒåŒæ—¶éŸ³é¢‘æ•°æ®ä¸å…¶å®ƒçš„æ•°æ®å†…å®¹æœ‰å…¶ç‰¹æ®Šæ€§ï¼Œé€šå¸¸ä¸€ç‚¹éŸ³é¢‘å¼‚å¸¸éƒ½å¾ˆå®¹æ˜“è¢«äººæ„ŸçŸ¥å‡ºæ¥ã€‚å› æ­¤WebRTCé’ˆå¯¹éŸ³é¢‘ä¼ è¾“åšäº†å¾ˆå¤šé¢å¤–çš„å·¥ä½œï¼Œé™¤äº†æœ€å¸¸è§çš„ä¸¢åŒ…é‡ä¼ ï¼Œä¸¢åŒ…è¡¥å¿ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªNetEQæ¨¡å—ï¼Œä¼šåœ¨æ’­æ”¾ç«¯è¿›è¡ŒéŸ³é¢‘æ’­æ”¾çš„åŠ å‡é€Ÿæ¥è¿›ä¸€æ­¥å‡å°‘ç”±äºç½‘ç»œæŠ–åŠ¨å¼•èµ·çš„éŸ³é¢‘å¼‚å¸¸ã€‚</p>
<!-- {% asset_img 005.png %} -->
<img src="/images/2021-12-22-005.png"/>
<p>åˆ°è¿™é‡ŒWebRTCä¸­è·ŸéŸ³é¢‘ç›¸å…³çš„æŠ€æœ¯æ¨¡å—éƒ½ç®€å•çš„è¿‡äº†ä¸€éï¼Œè¿™æ ·å¤§å®¶å¯¹äºWebRTCéŸ³é¢‘å¤„ç†æœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œè¿™é‡Œçš„æ¯ä¸ªæ¨¡å—å€¼å¾—æ·±å…¥å»å­¦ä¹ ï¼Œåé¢ä¹ŸæŠŠè‡ªå·±å­¦ä¹ çš„ä¸€äº›å¿ƒå¾—è®°å½•åœ¨è¿™é‡Œï¼Œå¤§å®¶ä¸€èµ·å­¦ä¹ å‘€ã€‚</p>]]></content:encoded>
    </item>
    <item>
      <title>WebRTCç³»åˆ—-WebRTC_Androidæºç ç¼–è¯‘</title>
      <link>https://lyapple2008.github.io/posts/202009/2020-09-07-webrtc-android%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</link>
      <pubDate>Mon, 07 Sep 2020 23:19:37 +0000</pubDate>
      <guid>https://lyapple2008.github.io/posts/202009/2020-09-07-webrtc-android%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/</guid>
      <description>&lt;h1 id=&#34;webrtc-androidæºç ç¼–è¯‘&#34;&gt;WebRTC Androidæºç ç¼–è¯‘&lt;/h1&gt;
&lt;p&gt;å¯¹äºWebRTCçš„å­¦ä¹ æ¥è¯´ï¼Œé¦–å…ˆéœ€è¦æå®šçš„æ˜¯æºç çš„ç¼–è¯‘ï¼Œç”±äºå›½å†…çš„ç‰¹æ®Šç¯å¢ƒå’ŒWebRTCæœ¬èº«çš„å¤æ‚æ€§ï¼Œå¯¼è‡´WebRTCæºç ç¼–è¯‘æˆäº†WebRTCå­¦ä¹ çš„ç¬¬ä¸€é“é—¨æ§›ã€‚è¿™é‡ŒæŠŠè‡ªå·±åœ¨ç¼–è¯‘WebRTCæºç è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›å‘è¿›è¡Œæ€»ç»“åˆ†äº«ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚ä¸»è¦å‚è€ƒå®˜ç½‘å’ŒWebRTCçš„ç¼–è¯‘é…ç½®è„šæœ¬ï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹éœ€è¦å…·å¤‡ç§‘å­¦ä¸Šå­¦çš„ç¯å¢ƒï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½å¥½ç¯å¢ƒå’Œæºç åï¼Œåé¢å°±ä¸éœ€è¦äº†ã€‚è¿™é‡Œä»¥Androidç«¯ä¸ºä¾‹ï¼Œç¼–è¯‘ç¯å¢ƒä¸ºUbuntu 18.04ï¼ˆå†é«˜ç‰ˆæœ¬ä¼šæç¤ºä¸æ”¯æŒï¼‰ï¼ŒWebRTCå®˜ç½‘æœ‰æåˆ°Androidç«¯æš‚æ—¶åªæ”¯æŒåœ¨Linuxä¸‹ç¼–è¯‘ã€‚è™½ç„¶ç½‘ä¸Šä¹Ÿæœ‰èµ„æºä»‹ç»åœ¨Macç¯å¢ƒä¸‹ç¼–è¯‘çš„ï¼Œä½†æ˜¯ç”¨è™šæ‹Ÿæœºè£…ä¸ªUbuntuè¿˜æ˜¯æŒºæ–¹ä¾¿çš„ï¼Œå’±å°±ä¸æŠ˜è…¾äº†ã€‚&lt;/p&gt;</description>
      <content:encoded><![CDATA[<h1 id="webrtc-androidæºç ç¼–è¯‘">WebRTC Androidæºç ç¼–è¯‘</h1>
<p>å¯¹äºWebRTCçš„å­¦ä¹ æ¥è¯´ï¼Œé¦–å…ˆéœ€è¦æå®šçš„æ˜¯æºç çš„ç¼–è¯‘ï¼Œç”±äºå›½å†…çš„ç‰¹æ®Šç¯å¢ƒå’ŒWebRTCæœ¬èº«çš„å¤æ‚æ€§ï¼Œå¯¼è‡´WebRTCæºç ç¼–è¯‘æˆäº†WebRTCå­¦ä¹ çš„ç¬¬ä¸€é“é—¨æ§›ã€‚è¿™é‡ŒæŠŠè‡ªå·±åœ¨ç¼–è¯‘WebRTCæºç è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›å‘è¿›è¡Œæ€»ç»“åˆ†äº«ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚ä¸»è¦å‚è€ƒå®˜ç½‘å’ŒWebRTCçš„ç¼–è¯‘é…ç½®è„šæœ¬ï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹éœ€è¦å…·å¤‡ç§‘å­¦ä¸Šå­¦çš„ç¯å¢ƒï¼Œç¬¬ä¸€æ¬¡ä¸‹è½½å¥½ç¯å¢ƒå’Œæºç åï¼Œåé¢å°±ä¸éœ€è¦äº†ã€‚è¿™é‡Œä»¥Androidç«¯ä¸ºä¾‹ï¼Œç¼–è¯‘ç¯å¢ƒä¸ºUbuntu 18.04ï¼ˆå†é«˜ç‰ˆæœ¬ä¼šæç¤ºä¸æ”¯æŒï¼‰ï¼ŒWebRTCå®˜ç½‘æœ‰æåˆ°Androidç«¯æš‚æ—¶åªæ”¯æŒåœ¨Linuxä¸‹ç¼–è¯‘ã€‚è™½ç„¶ç½‘ä¸Šä¹Ÿæœ‰èµ„æºä»‹ç»åœ¨Macç¯å¢ƒä¸‹ç¼–è¯‘çš„ï¼Œä½†æ˜¯ç”¨è™šæ‹Ÿæœºè£…ä¸ªUbuntuè¿˜æ˜¯æŒºæ–¹ä¾¿çš„ï¼Œå’±å°±ä¸æŠ˜è…¾äº†ã€‚</p>
<h1 id="å®‰è£…depots_toolså·¥å…·åŒ…">å®‰è£…depots_toolså·¥å…·åŒ…</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git</span></span></code></pre></td></tr></table>
</div>
</div>
<p>å°†depot_toolsç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim ~/.profile
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATH</span><span class="s2">:/path/to/depot_tools&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.profile</span></span></code></pre></td></tr></table>
</div>
</div>
<h1 id="ä¸‹è½½webrtcæºç ">ä¸‹è½½WebRTCæºç </h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fetch --nohooks webrtc_android</span></span></code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>ç”±äºWebRTCæºç æ¯”è¾ƒå¤§ï¼Œä¸­é—´ç½‘ç»œé—®é¢˜å¯èƒ½ä¼šå‡ºé”™ï¼Œå‡ºé”™çš„æ—¶å€™ç”¨gclient syncç»§ç»­å°±å¯ä»¥äº†</p>
</blockquote>
<h1 id="ä¸‹è½½ç¼–è¯‘æ‰€éœ€ä¾èµ–åŒ…å’Œå·¥å…·">ä¸‹è½½ç¼–è¯‘æ‰€éœ€ä¾èµ–åŒ…å’Œå·¥å…·</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./build/install-build-deps.sh --no-chromeos-fonts
</span></span><span class="line"><span class="cl">. /build/install-build-deps-android.sh</span></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="ä¸‹è½½æŒ‡å®šåˆ†æ”¯">ä¸‹è½½æŒ‡å®šåˆ†æ”¯</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout -b my_branch refs/remotes/branch-heads/83
</span></span><span class="line"><span class="cl">$ gclient sync</span></span></code></pre></td></tr></table>
</div>
</div>
<h1 id="æºç ç¼–è¯‘">æºç ç¼–è¯‘</h1>
<p>ç¬¬ä¸€æ¡å‘½ä»¤æ˜¯ç”Ÿæˆç¼–è¯‘å·¥ç¨‹çš„ï¼Œå¯ä»¥æ·»åŠ ä¸€äº›å‚æ•°æ¥æ§åˆ¶ç¼–è¯‘ç”Ÿæˆï¼Œè¿™é‡Œå¯ä»¥ç ”ç©¶ä¸‹æºç é‡Œçš„webrtc.gniæ–‡ä»¶ï¼Œé‡Œé¢æœ‰å¯ä»¥æŒ‡å®šçš„å‚æ•°ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸‰ä¸ªï¼š</p>
<blockquote>
<p>target_osï¼šå› ä¸ºæ˜¯åœ¨Androidå¹³å°ä¸Šè¿è¡Œçš„ï¼Œå› æ­¤è¿™é‡ŒæŒ‡å®šä¸º&quot;android&quot;
target_cpu: è¿™é‡ŒæŒ‡å®šè¿è¡Œçš„ç¡¬ä»¶å¹³å°ï¼Œarmå¹³å°åˆ™æ˜¯&quot;arm&quot;ï¼Œå¦‚æœæ˜¯arm64å¹³å°åˆ™æ˜¯&quot;arm64&quot;
is_debugï¼šè¡¨ç¤ºç”Ÿæˆæ˜¯å¦æ˜¯debugåŒ…</p>
</blockquote>
<p>ç¬¬äºŒæ¡å‘½ä»¤æ˜¯å¯åŠ¨ninjaå¼€å§‹ç¼–è¯‘ï¼Œç¼–è¯‘æˆåŠŸåï¼Œä¼šåœ¨out_arm/debugç›®å½•ç”Ÿæˆå¯¹åº”çš„jaråŒ…å’Œsoåº“æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">gn gen out_arm/debug --args<span class="o">=</span><span class="s1">&#39;is_debug=true target_os=&#34;android&#34; target_cpu=&#34;arm&#34; rtc_include_tests=false rtc_build_tools=false rtc_build_examples=false&#39;</span>
</span></span><span class="line"><span class="cl">ninja -C out_arm/debug</span></span></code></pre></td></tr></table>
</div>
</div>
<h1 id="ç¼–è¯‘é—®é¢˜è§£å†³">ç¼–è¯‘é—®é¢˜è§£å†³</h1>
<ul>
<li>é—®é¢˜ä¸€ï¼šgn.pyè¿è¡Œå¤±è´¥</li>
</ul>
<blockquote>
<p>gn.py: Could not find checkout in any parent of the current path.
This must be run inside a checkout.</p>
</blockquote>
<p>è¿™ä¸ªé—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨ï¼Œç§»åŠ¨äº†WebRTCæºç ç›®å½•çš„æ—¶å€™ã€‚è¿™é‡Œéœ€è¦çœ‹ä¸‹æ˜¯å¦å·²ç»æŠŠä¸‹è½½çš„WebRTCæºç éƒ½å®Œæ•´æ‹·è´äº†ï¼Œè¿›åˆ°ä¸‹è½½WebRTCæºç çš„ç›®å½•å¯ä»¥çœ‹åˆ°è¿™ä¸ªç›®å½•è¿˜æœ‰å‡ ä¸ªéšè—ç›®å½•å’Œæ–‡ä»¶ï¼Œè¿™å‡ ä¸ªæ–‡ä»¶ä¹Ÿæ˜¯éœ€è¦ä¸€èµ·æ‹·è´è¿‡å»çš„ï¼Œåé¢ç”¨gnå‘½ä»¤ç”Ÿæˆç¼–è¯‘å·¥ç¨‹çš„æ—¶å€™ä¼šå»æ£€æŸ¥è¿™å‡ ä¸ªæ–‡ä»¶ã€‚</p>
<blockquote>
<p>.cipd
.gclient
.gclient_entries</p>
</blockquote>
<ul>
<li>é—®é¢˜äºŒï¼š</li>
</ul>
<p>chromium styleé—®é¢˜
clang.gniä¸­å…³é—­chromium styleæ£€æŸ¥ï¼Œè¿™é‡Œåªæ˜¯æš‚æ—¶å…³é—­ï¼Œä¸ºäº†ä»£ç é£æ ¼çš„ç»Ÿä¸€ä»‹ç»è¿˜æ˜¯æŒ‰ç…§chromium styleè¿˜æ·»åŠ è‡ªå·±çš„ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">declare_args() {
</span></span><span class="line"><span class="cl"> Â # Indicates if the build should use the Chrome-specific plugins for enforcing
</span></span><span class="line"><span class="cl"> Â # coding guidelines, etc. Only used when compiling with Clang.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Â clang_use_chrome_plugins = false # is_clang &amp;&amp; !is_nacl &amp;&amp; !use_xcode_clang
</span></span><span class="line"><span class="cl"> Â clang_base_path = default_clang_base_path
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://webrtc.github.io/webrtc-org/native-code/development/">WebRTCå®˜ç½‘</a></li>
</ol>]]></content:encoded>
    </item>
  </channel>
</rss>
